# Solana Facility Game - å®Œå…¨æŠ€è¡“ä»•æ§˜æ›¸

## ğŸ¯ ãƒ—ãƒ­ã‚°ãƒ©ãƒ æ¦‚è¦

Solana ä¸Šã«æ§‹ç¯‰ã•ã‚ŒãŸé«˜åº¦ãªè¾²å ´ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚²ãƒ¼ãƒ ã§ã™ã€‚åŠæ¸›æœŸå ±é…¬ã‚·ã‚¹ãƒ†ãƒ ã€å¤šæ®µéšç´¹ä»‹ã‚·ã‚¹ãƒ†ãƒ ã€Pyth Entropy çµ±åˆã«ã‚ˆã‚‹çœŸã®ä¹±æ•°æ€§ã‚’ç‰¹å¾´ã¨ã™ã‚‹è¤‡é›‘ãªçµŒæ¸ˆãƒ¡ã‚«ãƒ‹ã‚ºãƒ ã‚’å®Ÿè£…ã—ã¦ã„ã¾ã™ã€‚ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒè¾²å ´ã‚¹ãƒšãƒ¼ã‚¹ã‚’ç®¡ç†ã—ã€ç¨®ã‚’æ ½åŸ¹ã—ã€æˆ¦ç•¥çš„æœ€é©åŒ–ã‚’é€šã˜ã¦ WEED ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ç²å¾—ã™ã‚‹å®Œå…¨ãªè¾²æ¥­ã‚¨ã‚³ã‚·ã‚¹ãƒ†ãƒ ã‚’æä¾›ã—ã¾ã™ã€‚

**ãƒ—ãƒ­ã‚°ãƒ©ãƒ  ID**: `FA1xdxZNykyJaMsuSekWJrUzwY8PVh1Usn7mR8eWmw5B`

### ğŸŒŸ ä¸»è¦ãªç‰¹å¾´

- **ğŸ­ ç”£æ¥­ãƒ¬ãƒ™ãƒ«ã®è¨­è¨ˆ**: Solana Production ç’°å¢ƒå‘ã‘ã®ä¼æ¥­ã‚°ãƒ¬ãƒ¼ãƒ‰å®Ÿè£…
- **ğŸ”¬ æ•°å­¦çš„ç²¾å¯†æ€§**: 128 ãƒ“ãƒƒãƒˆç®—è¡“ã«ã‚ˆã‚‹ã‚ªãƒ¼ãƒãƒ¼ãƒ•ãƒ­ãƒ¼å®Œå…¨é˜²æ­¢
- **ğŸ° å…¬å¹³æ€§ä¿è¨¼**: Pyth Entropy çµ±åˆã«ã‚ˆã‚‹æ¤œè¨¼å¯èƒ½ãªä¹±æ•°ã‚·ã‚¹ãƒ†ãƒ 
- **ğŸ’° é«˜åº¦ãªçµŒæ¸ˆå­¦**: åŠæ¸›æœŸè·¨ãè¨ˆç®—å¯¾å¿œã®æ´—ç·´ã•ã‚ŒãŸå ±é…¬åˆ†é…ã‚·ã‚¹ãƒ†ãƒ 
- **ğŸ” ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ•ã‚¡ãƒ¼ã‚¹ãƒˆ**: 37 ç¨®é¡ã®è©³ç´°ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã¨åŒ…æ‹¬çš„æ¤œè¨¼
- **ğŸš€ å®Ÿè£…å®Œäº†åº¦**: 20 ã®æ ¸å¿ƒå‘½ä»¤ã¨ãƒ¢ã‚¸ãƒ¥ãƒ©ãƒ¼æ‹¡å¼µã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

## ğŸ“‹ ç›®æ¬¡

- [ğŸ—ï¸ ã‚³ã‚¢ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£](#-ã‚³ã‚¢ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£)
- [ğŸ“Š ã‚¢ã‚«ã‚¦ãƒ³ãƒˆæ§‹é€ ](#-ã‚¢ã‚«ã‚¦ãƒ³ãƒˆæ§‹é€ )
- [ğŸ® ã‚²ãƒ¼ãƒ ãƒ¡ã‚«ãƒ‹ã‚¯ã‚¹](#-ã‚²ãƒ¼ãƒ ãƒ¡ã‚«ãƒ‹ã‚¯ã‚¹)
- [ğŸ’° çµŒæ¸ˆã‚·ã‚¹ãƒ†ãƒ ](#-çµŒæ¸ˆã‚·ã‚¹ãƒ†ãƒ )
- [ğŸš€ é«˜åº¦ãªæ©Ÿèƒ½](#-é«˜åº¦ãªæ©Ÿèƒ½)
- [ğŸ“Š çŠ¶æ…‹ç®¡ç†](#-çŠ¶æ…‹ç®¡ç†)
- [ğŸ”’ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ & æ¤œè¨¼](#-ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£--æ¤œè¨¼)
- [ğŸ“š å®Œå…¨å‘½ä»¤ã‚»ãƒƒãƒˆ](#-å®Œå…¨å‘½ä»¤ã‚»ãƒƒãƒˆ)
- [ğŸ”„ é–‹ç™ºçŠ¶æ³](#-é–‹ç™ºçŠ¶æ³)
- [ğŸ§ª å®Ÿè£…è©³ç´°](#-å®Ÿè£…è©³ç´°)

## ğŸ—ï¸ ã‚³ã‚¢ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

### ğŸ”§ ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«æ§‹é€ 

```
programs/facility-game/src/
â”œâ”€â”€ lib.rs                      # ãƒ¡ã‚¤ãƒ³ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚¨ãƒ³ãƒˆãƒªãƒ¼ï¼ˆ20å‘½ä»¤ï¼‰
â”œâ”€â”€ state.rs                    # ã‚¢ã‚«ã‚¦ãƒ³ãƒˆæ§‹é€  & ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«ï¼ˆ10æ§‹é€ ä½“ï¼‰
â”œâ”€â”€ error.rs                    # ã‚«ã‚¹ã‚¿ãƒ ã‚¨ãƒ©ãƒ¼å®šç¾©ï¼ˆ112ç¨®é¡ï¼‰
â”œâ”€â”€ constants.rs                # ä¸­å¤®é›†æ¨©åŒ–ã‚²ãƒ¼ãƒ å®šæ•°
â”œâ”€â”€ economics.rs                # çµŒæ¸ˆè¨ˆç®— & å…¬å¼ï¼ˆ11é–¢æ•°ï¼‰
â”œâ”€â”€ utils.rs                    # ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•° & ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
â”œâ”€â”€ validation/                 # ãƒ“ã‚¸ãƒã‚¹ãƒ«ãƒ¼ãƒ«æ¤œè¨¼
â”‚   â”œâ”€â”€ mod.rs                  # æ¤œè¨¼ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«çµ±åˆ
â”‚   â”œâ”€â”€ admin_validation.rs     # ç®¡ç†è€…æ¨©é™æ¤œè¨¼
â”‚   â”œâ”€â”€ economic_validation.rs  # çµŒæ¸ˆæ¤œè¨¼
â”‚   â”œâ”€â”€ game_validation.rs      # ã‚²ãƒ¼ãƒ ãƒ­ã‚¸ãƒƒã‚¯æ¤œè¨¼
â”‚   â”œâ”€â”€ time_validation.rs      # æ™‚é–“é–¢é€£æ¤œè¨¼
â”‚   â””â”€â”€ user_validation.rs      # ãƒ¦ãƒ¼ã‚¶ãƒ¼æ¤œè¨¼
â”œâ”€â”€ test_modules/               # ãƒ†ã‚¹ãƒˆãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«
â”‚   â”œâ”€â”€ economics_advanced_tests.rs
â”‚   â”œâ”€â”€ error_comprehensive_tests.rs
â”‚   â””â”€â”€ state_advanced_tests.rs
â”œâ”€â”€ tests/                      # çµ±åˆãƒ†ã‚¹ãƒˆ
â”‚   â”œâ”€â”€ admin_tests.rs
â”‚   â”œâ”€â”€ error_tests.rs
â”‚   â”œâ”€â”€ state_tests.rs
â”‚   â””â”€â”€ utils_tests.rs
â””â”€â”€ instructions/               # æ©Ÿèƒ½åˆ¥å‘½ä»¤ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«
    â”œâ”€â”€ mod.rs                  # å‘½ä»¤çµ±åˆ
    â”œâ”€â”€ admin.rs                # ç®¡ç†è€…å°‚ç”¨æ“ä½œï¼ˆ4å‘½ä»¤ï¼‰
    â”œâ”€â”€ user.rs                 # ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†ï¼ˆ1å‘½ä»¤ï¼‰
    â”œâ”€â”€ farm.rs                 # è¾²å ´ã‚¹ãƒšãƒ¼ã‚¹æ“ä½œï¼ˆ3å‘½ä»¤ï¼‰
    â”œâ”€â”€ rewards.rs              # å ±é…¬é…å¸ƒï¼ˆ4å‘½ä»¤ï¼‰
    â”œâ”€â”€ transfer.rs             # ãƒˆãƒ¼ã‚¯ãƒ³æ“ä½œï¼ˆ1å‘½ä»¤ï¼‰
    â”œâ”€â”€ invite.rs               # æ‹›å¾…ã‚³ãƒ¼ãƒ‰ã‚·ã‚¹ãƒ†ãƒ ï¼ˆ3å‘½ä»¤ï¼‰
    â”œâ”€â”€ seeds.rs                # ç¨® & ãƒŸã‚¹ãƒ†ãƒªãƒ¼ãƒ‘ãƒƒã‚¯ã‚·ã‚¹ãƒ†ãƒ ï¼ˆ5å‘½ä»¤ï¼‰
    â””â”€â”€ meteora.rs              # DEXçµ±åˆï¼ˆ1å‘½ä»¤ï¼‰
```

### ğŸ¯ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£è¨­è¨ˆåŸå‰‡

#### 1. **ãƒ¢ã‚¸ãƒ¥ãƒ©ãƒ¼åˆ†é›¢ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£**

- **å˜ä¸€è²¬ä»»åŸå‰‡**: å„ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã¯ç‰¹å®šã®æ©Ÿèƒ½é ˜åŸŸã‚’æ‹…å½“
- **ç–çµåˆè¨­è¨ˆ**: ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«é–“ã®ä¾å­˜é–¢ä¿‚ã‚’æœ€å°åŒ–
- **é«˜å‡é›†æ€§**: é–¢é€£æ©Ÿèƒ½ã‚’åŒä¸€ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«å†…ã«é›†ç´„

#### 2. **ã‚¨ãƒ³ã‚¿ãƒ¼ãƒ—ãƒ©ã‚¤ã‚ºã‚°ãƒ¬ãƒ¼ãƒ‰ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£**

- **Defense in Depth**: å¤šå±¤é˜²å¾¡ã«ã‚ˆã‚‹åŒ…æ‹¬çš„ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£
- **Fail-Safe è¨­è¨ˆ**: ã‚¨ãƒ©ãƒ¼æ™‚ã®å®‰å…¨ãªçŠ¶æ…‹é·ç§»
- **Zero Trust**: ã™ã¹ã¦ã®å…¥åŠ›ã‚’æ¤œè¨¼ãƒ»ã‚µãƒ‹ã‚¿ã‚¤ã‚º

#### 3. **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–**

- **O(1)æ“ä½œ**: å®šæ•°æ™‚é–“è¨ˆç®—ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ 
- **ãƒ¡ãƒ¢ãƒªåŠ¹ç‡**: ã‚³ãƒ³ãƒ‘ã‚¯ãƒˆãªãƒ‡ãƒ¼ã‚¿æ§‹é€ è¨­è¨ˆ
- **Gas æœ€é©åŒ–**: æœ€å°é™ã® CPIï¼ˆCross-Program Invocationï¼‰

### ğŸ”‘ PDAï¼ˆProgram Derived Addressï¼‰è¨­è¨ˆãƒ‘ã‚¿ãƒ¼ãƒ³

#### æ±ºå®šè«–çš„ PDA ã‚¸ã‚§ãƒãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³

ã™ã¹ã¦ã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã¯äºˆæ¸¬å¯èƒ½ãªã‚·ãƒ¼ãƒ‰æ§‹é€ ã‚’ä½¿ç”¨ï¼š

```rust
// ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚¢ã‚«ã‚¦ãƒ³ãƒˆï¼ˆå˜ä¸€ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ï¼‰
"config"                              â†’ Config
"global_stats"                        â†’ GlobalStats
"fee_pool"                           â†’ FeePool
"reward_mint"                        â†’ Mint
"mint_authority"                     â†’ MintAuthority

// ãƒ¦ãƒ¼ã‚¶ãƒ¼å›ºæœ‰ã‚¢ã‚«ã‚¦ãƒ³ãƒˆ
["user", user_pubkey]                â†’ UserState
["farm_space", user_pubkey]          â†’ FarmSpace
["seed_storage", user_pubkey]        â†’ SeedStorage
["reward_account", user_pubkey]      â†’ RewardAccount

// ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ä»˜ãã‚¢ã‚«ã‚¦ãƒ³ãƒˆ
["seed", user_pubkey, seed_id]       â†’ Seed
["seed_pack", user_pubkey, pack_id]  â†’ SeedPack
["invite_code", invite_code_bytes]   â†’ InviteCode

// Pyth Entropyçµ±åˆ
["entropy_request", user_pubkey, sequence] â†’ EntropyRequest
```

#### ğŸ›¡ï¸ PDA ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£åˆ©ç‚¹

- **æ±ºå®šè«–çš„ç”Ÿæˆ**: åŒã˜ã‚·ãƒ¼ãƒ‰ã‹ã‚‰å¸¸ã«åŒã˜ã‚¢ãƒ‰ãƒ¬ã‚¹
- **è¡çªé˜²æ­¢**: æš—å·å­¦çš„ã«ãƒ¦ãƒ‹ãƒ¼ã‚¯ãªã‚¢ãƒ‰ãƒ¬ã‚¹ç”Ÿæˆ
- **æ¨©é™åˆ¶å¾¡**: ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã®ã¿ãŒ PDA ã‚’åˆ¶å¾¡å¯èƒ½
- **æ¤œè¨¼å¯èƒ½æ€§**: ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã§ã‚¢ãƒ‰ãƒ¬ã‚¹äº‹å‰è¨ˆç®—

## ğŸ“Š ã‚¢ã‚«ã‚¦ãƒ³ãƒˆæ§‹é€ 

### ğŸ”§ å®Œå…¨ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

ã™ã¹ã¦ã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã¯å³å¯†ã«è¨­è¨ˆã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿æ§‹é€ ã‚’æŒã¡ã€å°†æ¥ã®æ‹¡å¼µæ€§ã‚’ç¢ºä¿ã—ã¦ã„ã¾ã™ã€‚

#### ğŸ“‹ ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚¢ã‚«ã‚¦ãƒ³ãƒˆï¼ˆå˜ä¸€ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ï¼‰

##### Configï¼ˆã‚·ã‚¹ãƒ†ãƒ è¨­å®šï¼‰
```rust
pub struct Config {
    pub base_rate: u64,                      // åŸºæœ¬å ±é…¬ãƒ¬ãƒ¼ãƒˆï¼ˆ100 WEED/ç§’ï¼‰
    pub halving_interval: i64,               // åŠæ¸›æœŸé–“éš”ï¼ˆ7æ—¥ = 604,800ç§’ï¼‰
    pub next_halving_time: i64,              // æ¬¡å›åŠæ¸›æœŸæ™‚åˆ»
    pub admin: Pubkey,                       // ã‚·ã‚¹ãƒ†ãƒ ç®¡ç†è€…
    pub treasury: Pubkey,                    // è²¡å‹™ã‚¦ã‚©ãƒ¬ãƒƒãƒˆ
    pub seed_pack_cost: u64,                 // ãƒ‘ãƒƒã‚¯ä¾¡æ ¼ï¼ˆ300 WEEDï¼‰
    pub seed_counter: u64,                   // ã‚°ãƒ­ãƒ¼ãƒãƒ«ç¨®ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼
    pub seed_pack_counter: u64,              // ã‚°ãƒ­ãƒ¼ãƒãƒ«ãƒ‘ãƒƒã‚¯ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼
    pub farm_space_cost_sol: u64,            // è¾²å ´ä¾¡æ ¼ï¼ˆ0.5 SOLï¼‰
    pub max_invite_limit: u8,                // æœ€å¤§æ‹›å¾…æ•°ï¼ˆ5äººï¼‰
    pub trading_fee_percentage: u8,          // å–å¼•æ‰‹æ•°æ–™ï¼ˆ2%ï¼‰
    pub protocol_referral_address: Pubkey,   // ãƒ—ãƒ­ãƒˆã‚³ãƒ«ç´¹ä»‹ã‚¢ãƒ‰ãƒ¬ã‚¹
    pub total_supply_minted: u64,            // ç·ç™ºè¡Œé‡è¿½è·¡
    pub operator: Pubkey,                    // é‹å–¶ç‰¹æ¨©ã‚¢ãƒ‰ãƒ¬ã‚¹
    pub reserve: [u8; 2],                    // å°†æ¥æ‹¡å¼µç”¨
}
// ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚µã‚¤ã‚º: 200ãƒã‚¤ãƒˆ
```

##### GlobalStatsï¼ˆã‚°ãƒ­ãƒ¼ãƒãƒ«çµ±è¨ˆï¼‰
```rust
pub struct GlobalStats {
    pub total_grow_power: u64,               // å…¨ä½“Grow Power
    pub total_farm_spaces: u64,              // ç·è¾²å ´æ•°
    pub total_supply: u64,                   // ç·ä¾›çµ¦é‡ï¼ˆ10å„„WEEDï¼‰
    pub current_rewards_per_second: u64,     // ç¾åœ¨ã®ç§’é–“å ±é…¬
    pub last_update_time: i64,               // æœ€çµ‚æ›´æ–°æ™‚åˆ»
    pub reserve: [u8; 32],                   // å°†æ¥æ‹¡å¼µç”¨
}
// ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚µã‚¤ã‚º: 80ãƒã‚¤ãƒˆ
```

##### FeePoolï¼ˆæ‰‹æ•°æ–™ãƒ—ãƒ¼ãƒ«ï¼‰
```rust
pub struct FeePool {
    pub accumulated_fees: u64,               // è“„ç©æ‰‹æ•°æ–™ï¼ˆWEEDï¼‰
    pub treasury_address: Pubkey,            // è²¡å‹™ã‚¢ãƒ‰ãƒ¬ã‚¹
    pub last_collection_time: i64,          // æœ€çµ‚å›åæ™‚åˆ»
    pub reserve: [u8; 48],                   // å°†æ¥æ‹¡å¼µç”¨
}
// ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚µã‚¤ã‚º: 96ãƒã‚¤ãƒˆ
```

#### ğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼å›ºæœ‰ã‚¢ã‚«ã‚¦ãƒ³ãƒˆ

##### UserStateï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼çŠ¶æ…‹ï¼‰
```rust
pub struct UserState {
    pub owner: Pubkey,                       // ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¦ã‚©ãƒ¬ãƒƒãƒˆ
    pub total_grow_power: u64,               // ç·Grow Power
    pub last_harvest_time: i64,              // æœ€çµ‚åç©«æ™‚åˆ»
    pub has_farm_space: bool,                // è¾²å ´æ‰€æœ‰ãƒ•ãƒ©ã‚°
    pub referrer: Option<Pubkey>,            // ç´¹ä»‹è€…ï¼ˆä»»æ„ï¼‰
    pub pending_referral_rewards: u64,       // æœªè«‹æ±‚ç´¹ä»‹å ±é…¬
    pub reserve: [u8; 32],                   // å°†æ¥æ‹¡å¼µç”¨
}
// ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚µã‚¤ã‚º: 130ãƒã‚¤ãƒˆ
```

##### FarmSpaceï¼ˆè¾²å ´ã‚¹ãƒšãƒ¼ã‚¹ï¼‰
```rust
pub struct FarmSpace {
    pub owner: Pubkey,                       // è¾²å ´æ‰€æœ‰è€…
    pub level: u8,                           // ãƒ¬ãƒ™ãƒ«ï¼ˆ1-5ï¼‰
    pub capacity: u8,                        // æœ€å¤§ç¨®å®¹é‡
    pub seed_count: u8,                      // ç¾åœ¨æ¤ãˆä»˜ã‘æ•°
    pub total_grow_power: u64,               // è¾²å ´å†…ç·Grow Power
    pub upgrade_start_time: i64,             // ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰é–‹å§‹æ™‚åˆ»
    pub upgrade_target_level: u8,            // ç›®æ¨™ãƒ¬ãƒ™ãƒ«
    pub reserve: [u8; 32],                   // å°†æ¥æ‹¡å¼µç”¨
}
// ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚µã‚¤ã‚º: 92ãƒã‚¤ãƒˆ
```

##### SeedStorageï¼ˆç¨®åœ¨åº«ï¼‰ğŸ’° ã‚³ã‚¹ãƒˆæœ€é©åŒ–è¨­è¨ˆ
```rust
pub struct SeedStorage {
    pub owner: Pubkey,                       // æ‰€æœ‰è€…
    pub seed_ids: Vec<u64>,                  // ç¨®IDãƒªã‚¹ãƒˆï¼ˆæœ€å¤§1,000å€‹ï¼‰
    pub total_seeds: u16,                    // ç¾åœ¨ã®ç¨®æ•°
    pub reserve: [u8; 32],                   // å°†æ¥æ‹¡å¼µç”¨
}
// ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚µã‚¤ã‚º: 8,078ãƒã‚¤ãƒˆï¼ˆ1,000ç¨®ãƒ•ãƒ«æ™‚ï¼‰
// 200å€‹ãƒŸã‚¹ãƒ†ãƒªãƒ¼ãƒ‘ãƒƒã‚¯åˆ†ã®å®¹é‡ = ä¸€èˆ¬ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ã¯ååˆ†
```

#### ğŸ’° **ã‚³ã‚¹ãƒˆæœ€é©åŒ–è¨­è¨ˆ**: æ‰‹é ƒãªä¾¡æ ¼ã§ãƒŸã‚¹ãƒ†ãƒªãƒ¼ãƒ‘ãƒƒã‚¯è³¼å…¥å¯¾å¿œ

`SeedStorage`ã¯**æœ€å¤§1,000ç¨®**ã¾ã§ä¿å­˜å¯èƒ½ã«è¨­è¨ˆã•ã‚Œã¦ã„ã¾ã™ã€‚

**å®¹é‡è©³ç´°**:
- 1ãƒ‘ãƒƒã‚¯ = 5ç¨®ç”Ÿæˆ
- 200ãƒ‘ãƒƒã‚¯åˆ† = 1,000ç¨®å®¹é‡
- å¿…è¦ãªSOL: ç´„0.06 SOLï¼ˆã‚¢ã‚«ã‚¦ãƒ³ãƒˆä½œæˆæ™‚ã«ãƒ­ãƒƒã‚¯ï¼‰
- ç¶™ç¶šã‚³ã‚¹ãƒˆ: **æ°¸ä¹…ã«0 SOL**

**å®Ÿè£…æ¸ˆã¿å®¹é‡**:
```rust
pub const MAX_SEEDS: usize = 1_000;  // 1,000ç¨®ã¾ã§ä¿å­˜å¯èƒ½
// ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚µã‚¤ã‚º: ~8KB
// å¿…è¦SOL: ~0.06 SOLï¼ˆã‚¢ã‚«ã‚¦ãƒ³ãƒˆã«ãƒ­ãƒƒã‚¯ã•ã‚Œã‚‹ï¼‰
// ç¶™ç¶šè²»ç”¨: 0 SOLï¼ˆæ°¸ä¹…ç„¡æ–™ï¼‰
// éå¸¸ã«æ‰‹é ƒãªä¾¡æ ¼è¨­å®š
```

#### ğŸŒ± ã‚¢ã‚¤ãƒ†ãƒ å›ºæœ‰ã‚¢ã‚«ã‚¦ãƒ³ãƒˆ

##### Seedï¼ˆå€‹åˆ¥ç¨®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆï¼‰
```rust
pub struct Seed {
    pub owner: Pubkey,                       // ç¨®æ‰€æœ‰è€…
    pub seed_type: SeedType,                 // ç¨®ã‚¿ã‚¤ãƒ—ï¼ˆSeed1-9ï¼‰
    pub grow_power: u64,                     // Grow Powerå€¤
    pub is_planted: bool,                    // æ¤ãˆä»˜ã‘çŠ¶æ…‹
    pub planted_farm_space: Option<Pubkey>,  // æ¤ãˆä»˜ã‘å…ˆè¾²å ´
    pub created_at: i64,                     // ä½œæˆæ™‚åˆ»
    pub seed_id: u64,                        // ãƒ¦ãƒ‹ãƒ¼ã‚¯ç¨®ID
    pub reserve: [u8; 32],                   // å°†æ¥æ‹¡å¼µç”¨
}
// ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚µã‚¤ã‚º: 131ãƒã‚¤ãƒˆ
```

##### SeedPackï¼ˆç¨®ãƒ‘ãƒƒã‚¯ï¼‰
```rust
pub struct SeedPack {
    pub purchaser: Pubkey,                   // è³¼å…¥è€…
    pub purchased_at: i64,                   // è³¼å…¥æ™‚åˆ»
    pub cost_paid: u64,                      // æ”¯æ‰•ã„é¡
    pub is_opened: bool,                     // é–‹å°çŠ¶æ…‹
    pub entropy_sequence: u64,               // Pythã‚·ãƒ¼ã‚±ãƒ³ã‚¹ç•ªå·
    pub user_entropy_seed: u64,              // ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¨ãƒ³ãƒˆãƒ­ãƒ”ãƒ¼
    pub final_random_value: u64,             // æœ€çµ‚ä¹±æ•°å€¤
    pub pack_id: u64,                        // ãƒ‘ãƒƒã‚¯ID
    pub reserve: [u8; 16],                   // å°†æ¥æ‹¡å¼µç”¨
}
// ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚µã‚¤ã‚º: 113ãƒã‚¤ãƒˆ
```

##### InviteCodeï¼ˆæ‹›å¾…ã‚³ãƒ¼ãƒ‰ï¼‰
```rust
pub struct InviteCode {
    pub inviter: Pubkey,                     // æ‹›å¾…è€…
    pub invites_used: u8,                    // ä½¿ç”¨æ¸ˆã¿æ‹›å¾…æ•°
    pub invite_limit: u8,                    // æ‹›å¾…ä¸Šé™
    pub code: [u8; 8],                       // 8æ–‡å­—ã‚³ãƒ¼ãƒ‰
    pub created_at: i64,                     // ä½œæˆæ™‚åˆ»
    pub reserve: [u8; 32],                   // å°†æ¥æ‹¡å¼µç”¨
}
// ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚µã‚¤ã‚º: 83ãƒã‚¤ãƒˆ
```

#### ğŸ“ˆ ã‚¹ã‚±ãƒ¼ãƒ©ãƒ“ãƒªãƒ†ã‚£åˆ†æ

**å®Ÿè£…æ¸ˆã¿å®¹é‡**:
- SeedStorage: 1,000ç¨® = 200ãƒ‘ãƒƒã‚¯åˆ†
- ãƒŸã‚¹ãƒ†ãƒªãƒ¼ãƒ‘ãƒƒã‚¯è³¼å…¥ã«**æ‰‹é ƒãªä¾¡æ ¼ã§å¯¾å¿œ**
- ä¸€èˆ¬ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ã¯ååˆ†ãªå®¹é‡

**å®¹é‡è©³ç´°**:
```rust
const MAX_SEEDS: usize = 1_000;  // ã‚³ã‚¹ãƒˆæœ€é©åŒ–å®¹é‡
// 200ãƒ‘ãƒƒã‚¯åˆ† = 6ä¸‡WEEDç›¸å½“
// å¿…è¦SOL: ç´„0.06 SOLï¼ˆã‚¢ã‚«ã‚¦ãƒ³ãƒˆä½œæˆæ™‚ï¼‰
// è¿½åŠ è²»ç”¨: ãªã—ï¼ˆæ°¸ä¹…ç„¡æ–™ï¼‰
```

**å®¹é‡æ¯”è¼ƒ**:
- åˆæœŸè¨­è¨ˆ: 100ç¨®ï¼ˆ20ãƒ‘ãƒƒã‚¯åˆ†ï¼‰
- ç¾åœ¨è¨­è¨ˆ: 1,000ç¨®ï¼ˆ200ãƒ‘ãƒƒã‚¯åˆ†ï¼‰
- **10å€ã®å®¹é‡æ‹¡å¼µ** = æ‰‹é ƒã§å®Ÿç”¨çš„

**å®Ÿéš›ã®ã‚³ã‚¹ãƒˆ**:
- 200ãƒ‘ãƒƒã‚¯è³¼å…¥ = 60,000 WEEDå¿…è¦
- ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«å¿…è¦ãªSOL: 0.06 SOLï¼ˆä¸€åº¦ã ã‘ï¼‰
- ã“ã®SOLã¯ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã«ãƒ­ãƒƒã‚¯ã•ã‚Œã€ã‚²ãƒ¼ãƒ ã‚’ãƒ—ãƒ¬ã‚¤ã™ã‚‹é™ã‚Šæ°¸ç¶šçš„ã«ä½¿ç”¨
- éå¸¸ã«æ‰‹é ƒãªåˆæœŸæŠ•è³‡ï¼ˆ0.5 SOLã®è¾²å ´è³¼å…¥è²»ã‚ˆã‚Šå®‰ã„ï¼‰

## ğŸ® ã‚²ãƒ¼ãƒ ãƒ¡ã‚«ãƒ‹ã‚¯ã‚¹

### 1. ğŸ”„ ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«

#### åŸºæœ¬ãƒ•ãƒ­ãƒ¼

```rust
// ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚ªãƒ³ãƒœãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ãƒ•ãƒ­ãƒ¼
init_user(referrer?) â†’ buy_farm_space() â†’ plant_seeds() â†’ claim_rewards()
```

#### ğŸŒŸ ä¸»è¦æ©Ÿèƒ½

- **ä»»æ„ç´¹ä»‹ã‚·ã‚¹ãƒ†ãƒ **: ç™»éŒ²æ™‚ã«ç´¹ä»‹è€…ã‚’è¨­å®šå¯èƒ½
- **è‡ªå‹•ãƒ¬ãƒ™ãƒ« 1 è¾²å ´**: è³¼å…¥æ™‚ã«åˆæœŸè¾²å ´ã‚¹ãƒšãƒ¼ã‚¹ã‚’è‡ªå‹•åˆæœŸåŒ–
- **ç„¡æ–™åˆæœŸç¨®**: è¾²å ´è³¼å…¥æ™‚ã« Seed1ï¼ˆ100 Grow Powerï¼‰ã‚’ç„¡æ–™ä»˜ä¸
- **å¤šæ®µéšç´¹ä»‹è¿½è·¡**: Level 1ï¼ˆ10%ï¼‰ã€Level 2ï¼ˆ5%ï¼‰ã®å ±é…¬ã‚·ã‚¹ãƒ†ãƒ 
- **å³åº§é–‹å§‹**: è¤‡é›‘ãªåˆæœŸè¨­å®šãªã—ã§å³åº§ã«ã‚²ãƒ¼ãƒ é–‹å§‹å¯èƒ½

#### è©³ç´°ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¸ãƒ£ãƒ¼ãƒ‹ãƒ¼

```rust
1. init_user() {
    // ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¢ã‚«ã‚¦ãƒ³ãƒˆä½œæˆ
    // ç´¹ä»‹é–¢ä¿‚è¨˜éŒ²ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
    // åˆæœŸçµ±è¨ˆè¨­å®š
}

2. buy_farm_space() {
    // 0.5 SOLæ”¯æ‰•ã„ï¼ˆãƒˆãƒ¬ã‚¸ãƒ£ãƒªãƒ¼ã¸ï¼‰
    // ãƒ¬ãƒ™ãƒ«1è¾²å ´ä½œæˆï¼ˆå®¹é‡4ï¼‰
    // ç„¡æ–™Seed1ä»˜ä¸
    // GlobalStatsæ›´æ–°
}

3. ã‚²ãƒ¼ãƒ ãƒ—ãƒ¬ã‚¤ãƒ«ãƒ¼ãƒ— {
    // ç¨®ã®æ¤ãˆä»˜ã‘/é™¤å»
    // ãƒŸã‚¹ãƒ†ãƒªãƒ¼ãƒ‘ãƒƒã‚¯è³¼å…¥
    // è¾²å ´ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰
    // å ±é…¬è«‹æ±‚
}
```

### 2. ğŸ¡ è¾²å ´ã‚¹ãƒšãƒ¼ã‚¹ã‚·ã‚¹ãƒ†ãƒ 

#### è³¼å…¥ & ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰æ–™é‡‘ä½“ç³»

```rust
// åˆæœŸè³¼å…¥
ãƒ¬ãƒ™ãƒ«1è¾²å ´: 0.5 SOL â†’ å®¹é‡4ï¼ˆ4ç¨®ã¾ã§æ¤ãˆä»˜ã‘å¯èƒ½ï¼‰

// ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰æ–™é‡‘ï¼ˆWEEDç‡ƒç„¼ï¼‰
L1â†’L2: 3,500 WEED   (3.5M tokens)  â†’ å®¹é‡8  (+100%å®¹é‡)
L2â†’L3: 18,000 WEED  (18M tokens)   â†’ å®¹é‡12 (+50%å®¹é‡)
L3â†’L4: 20,000 WEED  (20M tokens)   â†’ å®¹é‡16 (+33%å®¹é‡)
L4â†’L5: 25,000 WEED  (25M tokens)   â†’ å®¹é‡20 (+25%å®¹é‡)
```

#### ğŸ• ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ãƒ¡ã‚«ãƒ‹ã‚ºãƒ 

```rust
1. upgrade_farm_space() {
    // å¿…è¦WEEDé‡ã®ç‡ƒç„¼
    // ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰é–‹å§‹æ™‚åˆ»è¨˜éŒ²
    // ç›®æ¨™ãƒ¬ãƒ™ãƒ«è¨­å®š
    // 24æ™‚é–“ã‚¯ãƒ¼ãƒ«ãƒ€ã‚¦ãƒ³é–‹å§‹
}

2. complete_farm_space_upgrade() {
    // 24æ™‚é–“çµŒéç¢ºèª
    // ãƒ¬ãƒ™ãƒ« & å®¹é‡æ›´æ–°
    // çµ±è¨ˆæ›´æ–°
}
```

#### è¾²å ´ç®¡ç†æ§‹é€ ä½“

```rust
pub struct FarmSpace {
    pub owner: Pubkey,               // æ‰€æœ‰è€…
    pub level: u8,                   // ãƒ¬ãƒ™ãƒ«ï¼ˆ1-5ï¼‰
    pub capacity: u8,                // ç¨®å®¹é‡
    pub seed_count: u8,              // ç¾åœ¨æ¤ãˆä»˜ã‘æ•°
    pub total_grow_power: u64,       // åˆè¨ˆGrow Power
    pub upgrade_start_time: i64,     // ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰é–‹å§‹æ™‚åˆ»
    pub upgrade_target_level: u8,    // ç›®æ¨™ãƒ¬ãƒ™ãƒ«
    pub upgrade_cost_paid: u64,      // æ”¯æ‰•ã„æ¸ˆã¿ã‚³ã‚¹ãƒˆ
    pub last_maintenance_time: i64,  // æœ€çµ‚ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹æ™‚åˆ»
    pub reserve: [u8; 64],           // å°†æ¥æ‹¡å¼µç”¨
}
```

#### ğŸ¯ æˆ¦ç•¥çš„è€ƒå¯Ÿ

- **æ—©æœŸã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰**: è¤‡åˆ©åŠ¹æœã§é•·æœŸãƒªã‚¿ãƒ¼ãƒ³æœ€å¤§åŒ–
- **å®¹é‡æœ€é©åŒ–**: é«˜ Grow Power ç¨®ã¨ã®çµ„ã¿åˆã‚ã›æˆ¦ç•¥
- **ã‚³ã‚¹ãƒˆåŠ¹ç‡**: ãƒ¬ãƒ™ãƒ«æ¯ã® ROIï¼ˆæŠ•è³‡åç›Šç‡ï¼‰è¨ˆç®—å¿…è¦

### 3. ğŸŒ± ç¨® & ãƒ¬ã‚¢ãƒªãƒ†ã‚£ã‚·ã‚¹ãƒ†ãƒ 

#### ç¨®ã‚¿ã‚¤ãƒ— & ç¢ºç‡åˆ†å¸ƒè¡¨

| ç¨®ã‚¿ã‚¤ãƒ— | Grow Power | ãƒ‰ãƒ­ãƒƒãƒ—ç‡ | ç´¯ç©ç¢ºç‡ | ãƒ¬ã‚¢ãƒªãƒ†ã‚£ | ROI æœŸå¾…å€¤ |
| -------- | ---------- | ---------- | -------- | ---------- | ---------- |
| Seed1    | 100        | 42.23%     | 42.23%   | Common     | åŸºæº–å€¤     |
| Seed2    | 180        | 26.89%     | 69.12%   | Common     | 1.8Ã—       |
| Seed3    | 420        | 15.17%     | 84.29%   | Uncommon   | 4.2Ã—       |
| Seed4    | 720        | 8.06%      | 92.35%   | Uncommon   | 7.2Ã—       |
| Seed5    | 1,000      | 4.39%      | 96.74%   | Rare       | 10Ã—        |
| Seed6    | 5,000      | 2.22%      | 98.96%   | Rare       | 50Ã—        |
| Seed7    | 15,000     | 0.67%      | 99.63%   | Epic       | 150Ã—       |
| Seed8    | 30,000     | 0.31%      | 99.94%   | Legendary  | 300Ã—       |
| Seed9    | 60,000     | 0.06%      | 100.00%  | Mythical   | 600Ã—       |

#### ğŸ° ãƒŸã‚¹ãƒ†ãƒªãƒ¼ç¨®ãƒ‘ãƒƒã‚¯ã‚·ã‚¹ãƒ†ãƒ 

##### çµŒæ¸ˆãƒ¡ã‚«ãƒ‹ã‚ºãƒ 

```rust
// ã‚³ã‚¹ãƒˆ & ç‡ƒç„¼
ãƒ‘ãƒƒã‚¯ä¾¡æ ¼: 300 WEEDï¼ˆå®Œå…¨ç‡ƒç„¼ã§ãƒ‡ãƒ•ãƒ¬åŠ¹æœï¼‰
æœŸå¾…å€¤: ~142 Grow Powerï¼ˆæ•°å­¦çš„æœŸå¾…å€¤ï¼‰
ROIæ™‚é–“: ç´„2.1æ—¥ï¼ˆåŸºæº–ãƒ¬ãƒ¼ãƒˆ100 WEED/ç§’ã§å›åï¼‰
```

##### ğŸ² Pyth Entropy çµ±åˆã«ã‚ˆã‚‹æ¤œè¨¼å¯èƒ½ãªçœŸã®ä¹±æ•°ã‚·ã‚¹ãƒ†ãƒ 

#### ğŸ” ã‚¨ãƒ³ã‚¿ãƒ¼ãƒ—ãƒ©ã‚¤ã‚ºã‚°ãƒ¬ãƒ¼ãƒ‰ãƒ©ãƒ³ãƒ€ãƒ æ€§ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

å½“ã‚·ã‚¹ãƒ†ãƒ ã¯**å¤šé‡ã‚½ãƒ¼ã‚¹ã‚¨ãƒ³ãƒˆãƒ­ãƒ”ãƒ¼**ã¨**Commit-Reveal ã‚¹ã‚­ãƒ¼ãƒ **ã‚’æ¡ç”¨ã—ã€æ“ä½œä¸å¯èƒ½ã§æ¤œè¨¼å¯èƒ½ãªä¹±æ•°ç”Ÿæˆã‚’å®Ÿç¾ã—ã¦ã„ã¾ã™ã€‚

#### ğŸ“‹ ãƒ©ãƒ³ãƒ€ãƒ æ€§ã‚½ãƒ¼ã‚¹æ§‹æˆ

```rust
final_entropy = combine_entropy_sources(
    user_entropy_seed,      // ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆç”Ÿæˆæš—å·å­¦çš„å®‰å…¨ä¹±æ•°
    pyth_entropy_result,    // Pythã‚ªãƒ©ã‚¯ãƒ«ãƒ–ãƒ­ãƒƒã‚¯ãƒã‚§ãƒ¼ãƒ³ã‚¨ãƒ³ãƒˆãƒ­ãƒ”ãƒ¼
    block_timestamp,        // ãƒ–ãƒ­ãƒƒã‚¯æ™‚åˆ»æˆåˆ†
    sequence_number         // é †åºæ€§ä¿è¨¼
);
```

#### ğŸ”„ 2 ãƒ•ã‚§ãƒ¼ã‚º Commit-Reveal ãƒ—ãƒ­ãƒˆã‚³ãƒ«

##### **Phase 1: Commitï¼ˆè³¼å…¥ãƒ»ã‚³ãƒŸãƒƒãƒˆï¼‰**

```rust
purchase_seed_pack(quantity: u8, user_entropy_seed: u64) -> Result<()> {
    // 1. ãƒ¦ãƒ¼ã‚¶ãƒ¼æ”¯æ‰•ã„æ¤œè¨¼ & WEEDç‡ƒç„¼
    validate_payment_and_burn(quantity * 300_000_000); // 300 WEED/pack

    // 2. ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¨ãƒ³ãƒˆãƒ­ãƒ”ãƒ¼æ¤œè¨¼
    require!(user_entropy_seed != 0, GameError::InvalidUserEntropySeed);

    // 3. Pyth Entropyãƒªã‚¯ã‚¨ã‚¹ãƒˆé€ä¿¡
    let sequence = request_pyth_entropy(ctx, user_entropy_seed)?;

    // 4. SeedPackã‚¢ã‚«ã‚¦ãƒ³ãƒˆä½œæˆï¼ˆæœªé–‹å°çŠ¶æ…‹ï¼‰
    create_seed_pack_account(SeedPack {
        purchaser: user.key(),
        purchased_at: Clock::get()?.unix_timestamp,
        cost_paid: quantity * 300_000_000,
        is_opened: false,
        entropy_sequence: sequence,
        user_entropy_seed,
        final_random_value: 0, // æœªè¨­å®š
        pack_id: global_pack_counter,
        reserve: [0; 16],
    });

    // 5. ã‚°ãƒ­ãƒ¼ãƒãƒ«çµ±è¨ˆæ›´æ–°
    increment_global_pack_counter();
}
```

##### **Phase 2: Revealï¼ˆé–‹å°ãƒ»ãƒªãƒ“ãƒ¼ãƒ«ï¼‰**

```rust
open_seed_pack(quantity: u8) -> Result<()> {
    // 1. Pyth Entropyãƒ¬ã‚¹ãƒãƒ³ã‚¹å–å¾—
    let entropy_result = retrieve_entropy_result(ctx, seed_pack)?;

    // 2. ãƒãƒ«ãƒã‚½ãƒ¼ã‚¹ã‚¨ãƒ³ãƒˆãƒ­ãƒ”ãƒ¼çµåˆ
    let final_entropy = combine_entropy_sources(
        seed_pack.user_entropy_seed,
        entropy_result,
        seed_pack.purchased_at,
        seed_pack.entropy_sequence,
    );

    // 3. ç¨®ç”Ÿæˆï¼ˆãƒ‘ãƒƒã‚¯ã‚ãŸã‚Š5ç¨®ï¼‰
    let seeds = generate_seeds_from_entropy(final_entropy, quantity)?;

    // 4. ç¨®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆä½œæˆ & åœ¨åº«è¿½åŠ 
    for (index, seed_type) in seeds.iter().enumerate() {
        create_seed_account(seed_type, user.key(), global_seed_counter + index);
        add_seed_to_storage(user.key(), seed_type)?;
    }

    // 5. ãƒ‘ãƒƒã‚¯é–‹å°çŠ¶æ…‹æ›´æ–°
    seed_pack.is_opened = true;
    seed_pack.final_random_value = final_entropy;
}
```

#### ğŸ”’ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å®Ÿè£…è©³ç´°

##### **Pyth Entropy ãƒ¬ã‚¹ãƒãƒ³ã‚¹æ¤œè¨¼**

```rust
fn retrieve_entropy_result(
    ctx: &Context<OpenSeedPack>,
    seed_pack: &SeedPack
) -> Result<u64> {
    let entropy_request_data = ctx.accounts.entropy_request.try_borrow_data()?;

    // 1. ã‚¢ã‚«ã‚¦ãƒ³ãƒˆæ‰€æœ‰è€…æ¤œè¨¼ï¼ˆPyth Entropyãƒ—ãƒ­ã‚°ãƒ©ãƒ ï¼‰
    require!(
        *ctx.accounts.entropy_request.owner == ctx.accounts.pyth_entropy_program.key(),
        GameError::InvalidEntropyAccount
    );

    // 2. ã‚·ãƒ¼ã‚±ãƒ³ã‚¹ç•ªå·ç…§åˆ
    let result_sequence = u64::from_le_bytes(*array_ref![entropy_request_data, 0, 8]);
    require!(
        result_sequence == seed_pack.entropy_sequence,
        GameError::EntropySequenceMismatch
    );

    // 3. ã‚¨ãƒ³ãƒˆãƒ­ãƒ”ãƒ¼æº–å‚™çŠ¶æ…‹ç¢ºèª
    let random_value = u64::from_le_bytes(*array_ref![entropy_request_data, 8, 8]);
    require!(random_value != 0, GameError::EntropyNotReady);

    // 4. è¿½åŠ æ¤œè¨¼: ã‚¨ãƒ³ãƒˆãƒ­ãƒ”ãƒ¼å“è³ªãƒã‚§ãƒƒã‚¯
    validate_entropy_quality(random_value)?;

    Ok(random_value)
}
```

##### **ãƒãƒ«ãƒã‚½ãƒ¼ã‚¹ã‚¨ãƒ³ãƒˆãƒ­ãƒ”ãƒ¼çµåˆã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ **

```rust
fn combine_entropy_sources(
    user_seed: u64,
    pyth_entropy: u64,
    timestamp: i64,
    sequence: u64,
) -> u64 {
    // 1. åˆæœŸçµåˆ
    let mut combined = user_seed;

    // 2. Pyth Entropyã¨ã® XOR çµåˆ
    combined ^= pyth_entropy;

    // 3. æ™‚é–“æˆåˆ†è¿½åŠ ï¼ˆãƒªãƒ—ãƒ¬ã‚¤æ”»æ’ƒé˜²æ­¢ï¼‰
    combined = combined.wrapping_add(timestamp as u64);

    // 4. ã‚·ãƒ¼ã‚±ãƒ³ã‚¹ç•ªå·è¿½åŠ ï¼ˆé †åºæ€§ä¿è¨¼ï¼‰
    combined = combined.wrapping_mul(sequence);

    // 5. æš—å·å­¦çš„ãƒãƒƒã‚·ãƒ³ã‚°ï¼ˆåˆ†å¸ƒå“è³ªå‘ä¸Šï¼‰
    combined = cryptographic_hash_mix(combined);

    combined
}

fn cryptographic_hash_mix(input: u64) -> u64 {
    let mut x = input;

    // SplitMix64ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ï¼ˆé«˜å“è³ªæ“¬ä¼¼ä¹±æ•°ï¼‰
    x = x.wrapping_add(0x9e3779b97f4a7c15u64);
    x = (x ^ (x >> 30)).wrapping_mul(0xbf58476d1ce4e5b9u64);
    x = (x ^ (x >> 27)).wrapping_mul(0x94d049bb133111ebu64);
    x ^ (x >> 31)
}
```

#### ğŸ° ç¢ºç‡çš„ç¨®ç”Ÿæˆã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ 

##### **é«˜ç²¾åº¦ç¢ºç‡åˆ¶å¾¡ã‚·ã‚¹ãƒ†ãƒ **

```rust
fn generate_seeds_from_entropy(base_entropy: u64, quantity: u8) -> Result<Vec<SeedType>> {
    let mut seeds = Vec::with_capacity(quantity as usize);

    for i in 0..quantity {
        // å„ç¨®ã«ç‹¬ç«‹ã—ãŸä¹±æ•°å°å‡º
        let seed_entropy = derive_seed_randomness(base_entropy, i);

        // ç¢ºç‡ãƒ†ãƒ¼ãƒ–ãƒ«ç…§ä¼šï¼ˆ10000åˆ†ç‡ç²¾åº¦ï¼‰
        let seed_type = SeedType::from_random(seed_entropy);
        seeds.push(seed_type);

        // çµ±è¨ˆè¿½è·¡ï¼ˆãƒ‡ãƒãƒƒã‚°ãƒ»ç›£æŸ»ç”¨ï¼‰
        track_seed_generation_stats(seed_type);
    }

    Ok(seeds)
}

fn derive_seed_randomness(base_entropy: u64, index: u8) -> u64 {
    let mut derived = base_entropy;

    // ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ãƒ™ãƒ¼ã‚¹å·®åˆ†åŒ–
    derived = derived.wrapping_add(index as u64);

    // ç·šå½¢åˆåŒç”Ÿæˆå™¨ï¼ˆLCGï¼‰é©ç”¨
    derived = derived.wrapping_mul(6364136223846793005u64); // LCGä¹—æ•°
    derived = derived.wrapping_add(1442695040888963407u64); // LCGå¢—åˆ†

    // è¿½åŠ ãƒŸã‚­ã‚·ãƒ³ã‚°ï¼ˆåˆ†å¸ƒå“è³ªå‘ä¸Šï¼‰
    derived ^= derived >> 32;
    derived = derived.wrapping_mul(0x9e3779b97f4a7c15u64);
    derived ^= derived >> 32;

    derived
}
```

##### **ç¢ºç‡åˆ†å¸ƒå®Ÿè£…ï¼ˆ10000 åˆ†ç‡ç²¾åº¦ï¼‰**

```rust
impl SeedType {
    const PROBABILITY_THRESHOLDS: [u16; 9] = [
        4222,  // Seed1: 42.22% (0-4222)
        6666,  // Seed2: 24.44% (4223-6666)
        7999,  // Seed3: 13.33% (6667-7999)
        8832,  // Seed4: 8.33%  (8000-8832)
        9388,  // Seed5: 5.56%  (8833-9388)
        9721,  // Seed6: 3.33%  (9389-9721)
        9854,  // Seed7: 1.33%  (9722-9854)
        9943,  // Seed8: 0.89%  (9855-9943)
        10000, // Seed9: 0.57%  (9944-10000)
    ];

    pub fn from_random(random: u64) -> Self {
        // 10000åˆ†ç‡ã¸ã®æ­£è¦åŒ–
        let normalized = (random % 10000) as u16;

        // é«˜é€Ÿãƒã‚¤ãƒŠãƒªã‚µãƒ¼ãƒé¢¨ãƒ«ãƒƒã‚¯ã‚¢ãƒƒãƒ—
        for (i, &threshold) in Self::PROBABILITY_THRESHOLDS.iter().enumerate() {
            if normalized < threshold {
                return unsafe { std::mem::transmute(i as u8) };
            }
        }

        // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ï¼ˆæœ€é«˜ãƒ¬ã‚¢ãƒªãƒ†ã‚£ï¼‰
        SeedType::Seed9
    }
}
```

#### ğŸ”§ ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ & å …ç‰¢æ€§

##### **Pyth Entropy åˆ©ç”¨ä¸å¯æ™‚ã®ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯**

```rust
fn request_pyth_entropy(ctx: &Context<PurchaseSeedPack>, user_entropy_seed: u64) -> Result<u64> {
    // TODO: æœ¬æ ¼Pyth Entropy SDKçµ±åˆï¼ˆé–‹ç™ºä¸­ï¼‰

    // ä¸€æ™‚çš„æ±ºå®šè«–çš„ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯
    let current_time = Clock::get()?.unix_timestamp;
    let sequence = (current_time as u64)
        .wrapping_add(user_entropy_seed)
        .wrapping_mul(7919); // ç´ æ•°ã«ã‚ˆã‚‹åˆ†å¸ƒå‘ä¸Š

    msg!("ä½¿ç”¨ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒˆãƒ­ãƒ”ãƒ¼: sequence={}", sequence);
    Ok(sequence)
}
```

##### **ã‚¨ãƒ³ãƒˆãƒ­ãƒ”ãƒ¼å“è³ªæ¤œè¨¼**

```rust
fn validate_entropy_quality(entropy: u64) -> Result<()> {
    // 1. ã‚¼ãƒ­å€¤é™¤å¤–
    require!(entropy != 0, GameError::EntropyNotReady);

    // 2. é€£ç¶šå€¤é™¤å¤–ï¼ˆ0x0000... ã‚„ 0xFFFF...ï¼‰
    require!(
        entropy != u64::MAX && entropy != u64::MIN,
        GameError::InvalidEntropyValue
    );

    // 3. å˜ç´”ãƒ‘ã‚¿ãƒ¼ãƒ³é™¤å¤–
    let bytes = entropy.to_le_bytes();
    let unique_bytes = bytes.iter().collect::<std::collections::HashSet<_>>().len();
    require!(unique_bytes >= 4, GameError::LowEntropyQuality);

    Ok(())
}
```

#### ğŸ“Š PDA ã‚¢ã‚«ã‚¦ãƒ³ãƒˆè¨­è¨ˆ

##### **ã‚¨ãƒ³ãƒˆãƒ­ãƒ”ãƒ¼ãƒªã‚¯ã‚¨ã‚¹ãƒˆ PDA**

```rust
pub fn derive_entropy_request_key(
    user: Pubkey,
    sequence: u64,
    pyth_entropy_program: Pubkey,
) -> (Pubkey, u8) {
    Pubkey::find_program_address(
        &[
            b"entropy_request",
            user.as_ref(),
            &sequence.to_le_bytes(),
        ],
        &pyth_entropy_program,
    )
}
```

##### **ç¨®ãƒ‘ãƒƒã‚¯ã‚¢ã‚«ã‚¦ãƒ³ãƒˆæ§‹é€ **

```rust
pub struct SeedPack {
    pub purchaser: Pubkey,           // è³¼å…¥è€…ï¼ˆ32ãƒã‚¤ãƒˆï¼‰
    pub purchased_at: i64,           // è³¼å…¥æ™‚åˆ»ï¼ˆ8ãƒã‚¤ãƒˆï¼‰
    pub cost_paid: u64,              // æ”¯æ‰•ã„é¡ï¼ˆ8ãƒã‚¤ãƒˆï¼‰
    pub is_opened: bool,             // é–‹å°çŠ¶æ…‹ï¼ˆ1ãƒã‚¤ãƒˆï¼‰
    pub entropy_sequence: u64,       // Pythã‚·ãƒ¼ã‚±ãƒ³ã‚¹ç•ªå·ï¼ˆ8ãƒã‚¤ãƒˆï¼‰
    pub user_entropy_seed: u64,      // ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¨ãƒ³ãƒˆãƒ­ãƒ”ãƒ¼ï¼ˆ8ãƒã‚¤ãƒˆï¼‰
    pub final_random_value: u64,     // æœ€çµ‚ä¹±æ•°å€¤ï¼ˆ8ãƒã‚¤ãƒˆï¼‰
    pub pack_id: u64,                // ãƒ‘ãƒƒã‚¯IDï¼ˆ8ãƒã‚¤ãƒˆï¼‰
    pub opened_at: Option<i64>,      // é–‹å°æ™‚åˆ»ï¼ˆ9ãƒã‚¤ãƒˆï¼‰
    pub generated_seed_count: u8,    // ç”Ÿæˆç¨®æ•°ï¼ˆ1ãƒã‚¤ãƒˆï¼‰
    pub reserve: [u8; 16],           // å°†æ¥æ‹¡å¼µç”¨ï¼ˆ16ãƒã‚¤ãƒˆï¼‰
}
// åˆè¨ˆ: 125ãƒã‚¤ãƒˆï¼ˆSolanaæœ€å¤§åŒ–ï¼‰
```

#### ğŸ›¡ï¸ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¯¾ç­–ä¸€è¦§

| è„…å¨                   | å¯¾ç­–                   | å®Ÿè£…                          |
| ---------------------- | ---------------------- | ----------------------------- |
| **äºˆæ¸¬æ”»æ’ƒ**           | å¤šé‡ã‚½ãƒ¼ã‚¹ã‚¨ãƒ³ãƒˆãƒ­ãƒ”ãƒ¼ | User + Pyth + Time + Sequence |
| **ãƒªãƒ—ãƒ¬ã‚¤æ”»æ’ƒ**       | æ™‚åˆ»ãƒ»ã‚·ãƒ¼ã‚±ãƒ³ã‚¹çµ±åˆ   | ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—å¿…é ˆçµåˆ        |
| **æ“ä½œæ”»æ’ƒ**           | Commit-Reveal ã‚¹ã‚­ãƒ¼ãƒ  | 2 ãƒ•ã‚§ãƒ¼ã‚ºåˆ†é›¢å®Ÿè¡Œ            |
| **ã‚µãƒ¼ãƒ“ã‚¹åœæ­¢**       | ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯æ©Ÿæ§‹     | æ±ºå®šè«–çš„ä»£æ›¿ã‚¨ãƒ³ãƒˆãƒ­ãƒ”ãƒ¼      |
| **ã‚¢ã‚«ã‚¦ãƒ³ãƒˆå½è£…**     | PDA æ¤œè¨¼               | Pyth ãƒ—ãƒ­ã‚°ãƒ©ãƒ æ‰€æœ‰è€…æ¤œè¨¼     |
| **ã‚·ãƒ¼ã‚±ãƒ³ã‚¹æ”¹ç«„**     | æš—å·å­¦çš„ç…§åˆ           | å³å¯†ãªç•ªå·ãƒãƒƒãƒãƒ³ã‚°          |
| **ä½å“è³ªã‚¨ãƒ³ãƒˆãƒ­ãƒ”ãƒ¼** | å“è³ªæ¤œè¨¼               | ãƒ‘ã‚¿ãƒ¼ãƒ³ãƒ»é€£ç¶šå€¤é™¤å¤–          |

#### ğŸ“ˆ ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ & ç›£æŸ»

##### **Gas æœ€é©åŒ–**

- **ãƒãƒƒãƒå‡¦ç†**: è¤‡æ•°ç¨®ã®åŒæ™‚ç”Ÿæˆ
- **ãƒ«ãƒƒã‚¯ã‚¢ãƒƒãƒ—ãƒ†ãƒ¼ãƒ–ãƒ«**: O(1)ç¢ºç‡åˆ¤å®š
- **ãƒ¡ãƒ¢ãƒªåŠ¹ç‡**: ã‚³ãƒ³ãƒ‘ã‚¯ãƒˆãªæ§‹é€ ä½“è¨­è¨ˆ
- **æœ€å° CPI**: å¿…è¦æœ€å°é™ã®ã‚¯ãƒ­ã‚¹ãƒ—ãƒ­ã‚°ãƒ©ãƒ å‘¼ã³å‡ºã—

##### **ç›£æŸ»å¯èƒ½æ€§**

- **å®Œå…¨ãƒ­ã‚°**: ã™ã¹ã¦ã®ã‚¨ãƒ³ãƒˆãƒ­ãƒ”ãƒ¼ã‚½ãƒ¼ã‚¹è¨˜éŒ²
- **å†è¨ˆç®—å¯èƒ½**: åŒã˜ã‚·ãƒ¼ãƒ‰ã‹ã‚‰åŒã˜çµæœä¿è¨¼
- **çµ±è¨ˆè¿½è·¡**: ç¢ºç‡åˆ†å¸ƒã®å®Ÿç¸¾ç›£è¦–
- **ã‚¤ãƒ™ãƒ³ãƒˆç™ºè¡Œ**: ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰çµ±åˆã®ãŸã‚ã®è©³ç´°ã‚¤ãƒ™ãƒ³ãƒˆ

#### ğŸ”¬ ç¢ºç‡è¨ˆç®—ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ 

```rust
pub fn determine_seed_type(random_value: u64) -> SeedType {
    // 0-100000ã®ç¯„å›²ï¼ˆå°æ•°ç‚¹ä»¥ä¸‹3æ¡ç²¾åº¦ï¼‰
    let scaled_random = random_value % 100000;

    // ç´¯ç©ç¢ºç‡ã«ã‚ˆã‚‹é«˜é€Ÿãƒ«ãƒƒã‚¯ã‚¢ãƒƒãƒ—
    match scaled_random {
        0..=42229      => SeedType::Seed1,   // 42.23%
        42230..=69119  => SeedType::Seed2,   // 26.89%
        69120..=84289  => SeedType::Seed3,   // 15.17%
        84290..=92349  => SeedType::Seed4,   // 8.06%
        92350..=96739  => SeedType::Seed5,   // 4.39%
        96740..=98959  => SeedType::Seed6,   // 2.22%
        98960..=99629  => SeedType::Seed7,   // 0.67%
        99630..=99939  => SeedType::Seed8,   // 0.31%
        99940..=99999  => SeedType::Seed9,   // 0.06%
    }
}
```

### 4. ğŸ—‘ï¸ ç¨®å»ƒæ£„ã‚·ã‚¹ãƒ†ãƒ 

#### ğŸ’° ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ç®¡ç†ã¨çµŒæ¸ˆåŠ¹ç‡

ä¸è¦ãªç¨®ã‚’æ°¸ä¹…å‰Šé™¤ã—ã¦ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚¹ãƒšãƒ¼ã‚¹ã‚’ç¢ºä¿ã—ã€åŒæ™‚ã«ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®rentï¼ˆç´„0.002 SOL/ç¨®ï¼‰ã‚’å›åã§ãã¾ã™ã€‚

#### ğŸ”§ å»ƒæ£„ã‚·ã‚¹ãƒ†ãƒ ã®ä»•çµ„ã¿

```rust
// å€‹åˆ¥å»ƒæ£„ï¼ˆdiscard_seedï¼‰
- ç¨®ã®æ‰€æœ‰æ¨©: ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒæ‰€æœ‰ã™ã‚‹ç¨®ã®ã¿
- æœªæ¤ãˆä»˜ã‘: è¾²å ´ã«æ¤ãˆã‚‰ã‚Œã¦ã„ãªã„ç¨®ã®ã¿
- å³åº§å®Ÿè¡Œ: å¾…æ©Ÿæ™‚é–“ãªã—ã§å³åº§ã«å‰Šé™¤
- 1ç¨®ãšã¤å‡¦ç†: æ…é‡ãªå€‹åˆ¥ç®¡ç†

// ãƒãƒƒãƒå»ƒæ£„ï¼ˆbatch_discard_seedsï¼‰
- æœ€å¤§100ç¨®åŒæ™‚: åŠ¹ç‡çš„ãªå¤§é‡å»ƒæ£„
- è‡ªå‹•å®‰å…¨ãƒã‚§ãƒƒã‚¯: æ¤ãˆä»˜ã‘æ¸ˆã¿ç¨®ã¯è‡ªå‹•ã‚¹ã‚­ãƒƒãƒ—
- ä¸€æ‹¬rentå›å: å…¨å»ƒæ£„ç¨®ã®rentåˆè¨ˆã‚’ä¸€åº¦ã«å›å
- ã‚¨ãƒ©ãƒ¼è€æ€§: ä¸€éƒ¨å¤±æ•—ã§ã‚‚ä»–ã®ç¨®ã¯æ­£å¸¸å‡¦ç†

// å®Ÿè¡Œçµæœ
- ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‹ã‚‰ç¨®IDé™¤å»
- ç¨®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®å®Œå…¨å‰Šé™¤
- rentï¼ˆç´„0.002 SOL/ç¨®ï¼‰ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¸ã®è¿”å´
- ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸å®¹é‡ã®è§£æ”¾
```

#### ğŸ’¡ æˆ¦ç•¥çš„æ´»ç”¨

```rust
// åŠ¹ç‡çš„ãªæ•´ç†æ–¹æ³•
å€‹åˆ¥å»ƒæ£„ â†’ æ…é‡ã«é¸åˆ¥ã—ãŸã„é«˜ä¾¡å€¤ç¨®å‘¨è¾º
ãƒãƒƒãƒå»ƒæ£„ â†’ ä½å“è³ªç¨®ã®å¤§é‡å‡¦ç†ï¼ˆSeed1ç­‰ï¼‰

// çµŒæ¸ˆåŠ¹ç‡
100ç¨®ãƒãƒƒãƒå»ƒæ£„ â†’ ç´„0.2 SOLå³åº§å›å
1,000ç¨®æº€æ¯æ™‚ â†’ ç´„2 SOLåˆ†ã®rentå›åå¯èƒ½
ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸æœ€é©åŒ– â†’ ã‚ˆã‚Šå¤šãã®ãƒŸã‚¹ãƒ†ãƒªãƒ¼ãƒ‘ãƒƒã‚¯è³¼å…¥å¯èƒ½

// ä½¿ã„åˆ†ã‘æˆ¦ç•¥
discard_seed: 1-10ç¨®ç¨‹åº¦ã®æ…é‡ãªå»ƒæ£„
batch_discard_seeds: 50-100ç¨®ã®åŠ¹ç‡çš„å¤§é‡æ•´ç†
```

#### ğŸ›¡ï¸ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£æ©Ÿèƒ½

- **æ¤ãˆä»˜ã‘æ¸ˆã¿ç¨®ã®ä¿è­·**: è¾²å ´ã§ä½¿ç”¨ä¸­ã®ç¨®ã¯å»ƒæ£„ä¸å¯
- **æ‰€æœ‰æ¨©æ¤œè¨¼**: è‡ªåˆ†ã®ç¨®ã®ã¿å»ƒæ£„å¯èƒ½
- **å³åº§rentè¿”å´**: ã‚¢ã‚«ã‚¦ãƒ³ãƒˆå‰Šé™¤ã¨åŒæ™‚ã«SOLå›å

### 5. ğŸ¤ å¤šæ®µéšç´¹ä»‹å ±é…¬ã‚·ã‚¹ãƒ†ãƒ 

#### ğŸ“Š å®Œå…¨ãªç´¹ä»‹å ±é…¬è¨ˆç®—ãƒãƒˆãƒªãƒƒã‚¯ã‚¹

ç´¹ä»‹ã‚·ã‚¹ãƒ†ãƒ ã¯**å›ºå®šç·ç™ºè¡Œé‡ã§ã®åˆ†é…**ã§æˆé•·ã‚’ä¿ƒé€²ï¼š

| ã‚·ãƒŠãƒªã‚ª | è«‹æ±‚è€… | ç´¹ä»‹è€…(L1) | ç´¹ä»‹è€…ã®ç´¹ä»‹è€…(L2) | ç·ç™ºè¡Œé‡ | è«‹æ±‚è€…å®ŸåŠ¹ç‡ |
|----------|--------|------------|-------------------|----------|--------------|
| **ç´¹ä»‹è€…ãªã—** | 100% | - | - | 100% | ğŸŸ¢ **100%å–å¾—** |
| **ç´¹ä»‹è€…ã‚ã‚Š** | 90% | 10% | - | 100% | ğŸŸ¡ **90%å–å¾—** |
| **2æ®µéšç´¹ä»‹** | 85% | 10% | 5% | 100% | ğŸŸ  **85%å–å¾—** |

**é‡è¦**: ç·ç™ºè¡Œé‡ã¯å¸¸ã«**100%å›ºå®š**ã§ã€è«‹æ±‚è€…ã®å–å¾—ç‡ãŒç´¹ä»‹ãƒã‚§ãƒ¼ãƒ³ã«å¿œã˜ã¦å¤‰å‹•ã—ã¾ã™ã€‚

#### ğŸ¢ ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ç‰¹åˆ¥ãƒ«ãƒ¼ãƒ«

**Protocol Address (`config.protocol_referral_address`) ã®ç‰¹åˆ¥å‡¦ç†**ï¼š

```rust
// ğŸ”¹ ãƒ¦ãƒ¼ã‚¶ãƒ¼è‡ªèº«ãŒé‹å–¶ã‚¢ãƒ‰ãƒ¬ã‚¹ã®å ´åˆ
if user == protocol_address {
    user_receives: 100% (base_reward)
    distributions: None // ç´¹ä»‹åˆ†é…ã¯è¡Œã‚ãªã„
    effective_rate: 100%
}

// ğŸ”¹ Level 1ãŒé‹å–¶ã‚¢ãƒ‰ãƒ¬ã‚¹ã®å ´åˆ  
if level1_referrer == protocol_address {
    user_receives: 100% (protocolåˆ†ã‚‚è«‹æ±‚è€…ã«æˆ»ã‚‹)
    protocol_receives: 0% (é‹å–¶ã¯å—ã‘å–ã‚‰ãªã„)
    total_mint: 100%
}

// ğŸ”¹ Level 2ãŒé‹å–¶ã‚¢ãƒ‰ãƒ¬ã‚¹ã®å ´åˆ
if level2_referrer == protocol_address {
    user_receives: 95% (L2åˆ†ã‚‚è«‹æ±‚è€…ã«æˆ»ã‚‹)
    level1_receives: 10% (é€šå¸¸é€šã‚Š)
    protocol_receives: 0% (é‹å–¶ã¯å—ã‘å–ã‚‰ãªã„)
    total_mint: 100%
}
```

#### ğŸ§® è©³ç´°è¨ˆç®—ä¾‹

**åŸºæœ¬å ±é…¬ 1,000 WEED ã§ã®å®Ÿéš›ã®åˆ†é…**ï¼š

##### ã‚·ãƒŠãƒªã‚ª A: ç´¹ä»‹è€…ãªã—
```rust
claim_reward() {
    claimant_mint: 1,000 WEED â†’ Claimant Token Account
    total_supply_increase: 1,000 WEED
    claimant_gain: 1,000 WEED (100%) âœ…
}
```

##### ã‚·ãƒŠãƒªã‚ª B: ç´¹ä»‹è€…ã‚ã‚Š (Claimant â† Referrer)
```rust
claim_reward() + distribute_complete_referral() {
    claimant_mint: 900 WEED â†’ Claimant Token Account (è«‹æ±‚è€…90%)
    referrer_mint: 100 WEED â†’ Referrer Token Account (ç´¹ä»‹è€…10%)
    total_supply_increase: 1,000 WEED
    claimant_gain: 900 WEED (90%) ğŸ’š
    referrer_gain: 100 WEED (10%) ğŸ’°
}
```

##### ã‚·ãƒŠãƒªã‚ª C: 2æ®µéšç´¹ä»‹ãƒã‚§ãƒ¼ãƒ³ (Claimant â† L1 Referrer â† L2 Referrer)
```rust
claim_reward() + distribute_complete_referral() {
    claimant_mint: 850 WEED â†’ Claimant Token Account (è«‹æ±‚è€…85%)
    l1_referrer_mint: 100 WEED â†’ L1 Referrer Account (ç›´æ¥ç´¹ä»‹è€…10%)
    l2_referrer_mint: 50 WEED â†’ L2 Referrer Account (é–“æ¥ç´¹ä»‹è€…5%)
    total_supply_increase: 1,000 WEED
    claimant_gain: 850 WEED (85%) ğŸ§¡
    l1_referrer_gain: 100 WEED (10%) ğŸ’°
    l2_referrer_gain: 50 WEED (5%) ğŸ’°
}
```

##### ã‚·ãƒŠãƒªã‚ª D: ç´¹ä»‹è€…ãŒãƒ—ãƒ­ãƒˆã‚³ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹
```rust
claim_reward() + distribute_complete_referral() {
    claimant_mint: 1,000 WEED â†’ Claimant Token Account (è«‹æ±‚è€…100%ã€é‹å–¶åˆ†ã‚‚æˆ»ã‚‹)
    protocol_mint: 0 WEED â†’ Protocol Token Account (é‹å–¶ã¯å—ã‘å–ã‚‰ãªã„)
    total_supply_increase: 1,000 WEED
    claimant_gain: 1,000 WEED (100%) ğŸ’¼
    protocol_gain: 0 WEED (é‹å–¶ç‰¹åˆ¥ãƒ«ãƒ¼ãƒ«)
}
```

#### âš¡ å®Ÿè£…ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

##### ğŸ”„ ç´¹ä»‹æ–™è“„ç©ãƒ»è«‹æ±‚ã‚·ã‚¹ãƒ†ãƒ 

**ç´¹ä»‹è€…ãŒå ±é…¬ã‚’å—ã‘å–ã‚‹ä»•çµ„ã¿**ï¼š

```rust
// 1. èª°ã‹ãŒå ±é…¬ã‚’claimã—ãŸæ™‚ â†’ ç´¹ä»‹è€…ã®pending_referral_rewardsã«è“„ç©
accumulate_referral_reward(
    referrer_account,
    base_reward,
    referral_level, // 1 or 2 (Level 1: 10%, Level 2: 5%)
) -> {
    let referral_reward = base_reward * (if level == 1 { 10 } else { 5 }) / 100;
    referrer.pending_referral_rewards += referral_reward;
}

// 2. ç´¹ä»‹è€…ãŒè‡ªåˆ†ã®å ±é…¬ã‚’claimã™ã‚‹æ™‚ â†’ è“„ç©ã•ã‚ŒãŸç´¹ä»‹æ–™ã‚‚ä¸€ç·’ã«å—ã‘å–ã‚Š
claim_reward_with_referral_rewards() -> {
    let farming_reward = calculate_farming_reward();
    let (claimant_amount, _, _) = validate_referral_scenario(farming_reward, ...);
    let pending_referral_rewards = user.pending_referral_rewards;
    
    let total_reward = claimant_amount + pending_referral_rewards;
    mint_to_user(total_reward);
    user.pending_referral_rewards = 0; // æ¸…ç®—
}

// 3. è“„ç©é¡ç¢ºèª
view_pending_referral_rewards() -> {
    msg!("ğŸ’° Pending referral rewards: {} WEED", user.pending_referral_rewards);
}
```

##### ğŸ“Š æ–°ã—ã„å‘½ä»¤ã‚»ãƒƒãƒˆ

| å‘½ä»¤å | ç›®çš„ | ä½¿ç”¨ã‚¿ã‚¤ãƒŸãƒ³ã‚° |
|--------|------|----------------|
| `accumulate_referral_reward` | ç´¹ä»‹æ–™è“„ç© | èª°ã‹ãŒclaimã—ãŸæ™‚ã«è‡ªå‹•å®Ÿè¡Œ |
| `view_pending_referral_rewards` | è“„ç©é¡ç¢ºèª | ã„ã¤ã§ã‚‚ç¢ºèªå¯èƒ½ |
| `claim_reward_with_referral_rewards` | çµ±åˆclaim | ç´¹ä»‹è€…ãŒä½¿ç”¨ã™ã‚‹ä¸»è¦å‘½ä»¤ |

##### ğŸ¯ ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½“é¨“ãƒ•ãƒ­ãƒ¼

**ä¸€èˆ¬ãƒ¦ãƒ¼ã‚¶ãƒ¼**ï¼š
```rust
1. claim_reward_with_referral_rewards() // è¾²å ´å ±é…¬ + ç´¹ä»‹æ–™ã‚’åŒæ™‚å—å–
2. view_pending_referral_rewards()      // äº‹å‰ã«è“„ç©é¡ç¢ºèªå¯èƒ½
```

**ã‚·ã‚¹ãƒ†ãƒ å†…éƒ¨**ï¼š
```rust
1. ãƒ¦ãƒ¼ã‚¶ãƒ¼AãŒclaim â†’ Bã¨Cã®pending_referral_rewardsã«è“„ç©
2. ãƒ¦ãƒ¼ã‚¶ãƒ¼BãŒclaim â†’ è‡ªåˆ†ã®è¾²å ´å ±é…¬ + Aã‹ã‚‰ã®ç´¹ä»‹æ–™ã‚’åŒæ™‚å—å–
3. ãƒ¦ãƒ¼ã‚¶ãƒ¼CãŒclaim â†’ è‡ªåˆ†ã®è¾²å ´å ±é…¬ + AçµŒç”±ã®ç´¹ä»‹æ–™ã‚’åŒæ™‚å—å–
```

##### ğŸ’¡ åˆ©ç‚¹

- **ã‚·ãƒ³ãƒ—ãƒ«**: ç´¹ä»‹è€…ã¯æ™®é€šã«claimã™ã‚‹ã ã‘
- **é€æ˜æ€§**: äº‹å‰ã«è“„ç©é¡ã‚’ç¢ºèªå¯èƒ½
- **åŠ¹ç‡æ€§**: 1å›ã®ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ã§å…¨å—å–
- **ã‚¬ã‚¹æœ€é©åŒ–**: è¤‡æ•°ã®åˆ†é…ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ä¸è¦

#### ğŸ”’ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ & çµŒæ¸ˆä¿è­·

##### ãƒãƒ«ãƒãƒ¬ã‚¤ãƒ¤ãƒ¼æ¤œè¨¼
```rust
// 1. é–¢ä¿‚æ€§æ¤œè¨¼
require!(claimant_state.referrer == Some(level1_referrer.key()));
require!(level1_state.referrer == Some(level2_referrer.key()));

// 2. ä¾›çµ¦é‡ä¿è­·  
validate_supply_cap(total_supply_minted, new_mint_amount)?;

// 3. ã‚ªãƒ¼ãƒãƒ¼ãƒ•ãƒ­ãƒ¼é˜²æ­¢
base_reward.checked_mul(10)?.checked_div(100)?;

// 4. ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹æ¤œè¨¼
if referrer_key == config.protocol_referral_address { /* ç‰¹åˆ¥å‡¦ç† */ }
```

##### ç›£æŸ»å¯èƒ½æ€§ & ã‚¤ãƒ™ãƒ³ãƒˆç™ºè¡Œ
```rust
// è©³ç´°ãƒ­ã‚°ã§é€æ˜æ€§ç¢ºä¿
msg!("ğŸ§® Referral calculation: Base={}, User={}%, L1={}%, L2={}%");
msg!("ğŸ’° Actual amounts: User={}, L1={}, L2={}, Total={}");
msg!("ğŸ¯ Complete referral distribution: {} WEED total distributed");

// ç´¹ä»‹æ–™è“„ç©ã‚¤ãƒ™ãƒ³ãƒˆ
emit!(ReferralRewardAccumulatedEvent {
    referrer: referrer_key,
    amount: referral_reward,
    level: referral_level,
    from_user: claimant_key,
    timestamp: current_time,
});

// ç´¹ä»‹æ–™ç¢ºèªã‚¤ãƒ™ãƒ³ãƒˆ
emit!(PendingReferralRewardsEvent {
    user: user_key,
    pending_amount,
    timestamp: current_time,
});

// ç´¹ä»‹æ–™è«‹æ±‚ã‚¤ãƒ™ãƒ³ãƒˆ
emit!(ReferralRewardClaimedEvent {
    user: user_key,
    amount: pending_referral_rewards,
    total_claimed: total_reward,
    timestamp: current_time,
});
```

#### ğŸ’¡ æˆ¦ç•¥çš„ã‚¤ãƒ³ã‚»ãƒ³ãƒ†ã‚£ãƒ–è¨­è¨ˆ

##### ãƒ¦ãƒ¼ã‚¶ãƒ¼è¦–ç‚¹ã§ã®åˆ©ç›Š
- **è«‹æ±‚è€…**: ç´¹ä»‹ãƒã‚§ãƒ¼ãƒ³ã«å¿œã˜ã¦85%ï½100%ã‚’å—å–
- **ç´¹ä»‹è€…**: **è‡ªåˆ†ãŒclaimã™ã‚‹æ™‚ã«è“„ç©ã•ã‚ŒãŸç´¹ä»‹æ–™ã‚‚ä¸€ç·’ã«å—å–**
- **é€æ˜æ€§**: ã„ã¤ã§ã‚‚è“„ç©é¡ã‚’äº‹å‰ç¢ºèªå¯èƒ½
- **åŠ¹ç‡æ€§**: 1å›ã®ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ã§å…¨å—å–

##### ãƒ—ãƒ­ãƒˆã‚³ãƒ«è¦–ç‚¹ã§ã®åˆ©ç›Š
- **æˆé•·åŠ é€Ÿ**: ç´¹ä»‹ã‚¤ãƒ³ã‚»ãƒ³ãƒ†ã‚£ãƒ–ã«ã‚ˆã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼ç²å¾—ä¿ƒé€²
- **ã‚¬ã‚¹åŠ¹ç‡**: è¤‡æ•°ã®åˆ†é…ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ä¸è¦
- **åˆ†æ•£åŒ–ä¿ƒé€²**: ä¸€èˆ¬ãƒ¦ãƒ¼ã‚¶ãƒ¼é–“ã®æœ‰æ©Ÿçš„ç´¹ä»‹é–¢ä¿‚æ§‹ç¯‰
- **æŒç¶šæ€§**: å›ºå®šç·ç™ºè¡Œé‡ã§ã‚¤ãƒ³ãƒ•ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³åˆ¶å¾¡

#### ğŸ”„ ç´¹ä»‹æ–™è“„ç©ãƒ»è«‹æ±‚ã‚·ã‚¹ãƒ†ãƒ 

##### ğŸ—ï¸ ã‚·ã‚¹ãƒ†ãƒ è¨­è¨ˆ

**è“„ç©ãƒ•ã‚§ãƒ¼ã‚º**ï¼š
```rust
// èª°ã‹ãŒclaim â†’ ç´¹ä»‹è€…ã®pending_referral_rewardsã«è“„ç©
accumulate_referral_reward(referrer, base_reward, level) {
    let bonus = base_reward * (if level == 1 { 10 } else { 5 }) / 100;
    referrer.pending_referral_rewards += bonus;
}
```

**ç¢ºèªãƒ•ã‚§ãƒ¼ã‚º**ï¼š
```rust
// ã„ã¤ã§ã‚‚è“„ç©é¡ç¢ºèªå¯èƒ½
view_pending_referral_rewards() {
    msg!("ğŸ’° Pending: {} WEED", user.pending_referral_rewards);
}
```

**è«‹æ±‚ãƒ•ã‚§ãƒ¼ã‚º**ï¼š
```rust
// è‡ªåˆ†ã®claimæ™‚ã«è“„ç©åˆ†ã‚‚åŒæ™‚å—å–
claim_reward_with_referral_rewards() {
    let farming_reward = calculate_farming_reward();
    let (claimant_amount, _, _) = validate_referral_scenario(farming_reward);
    let pending = user.pending_referral_rewards;
    
    mint_to_user(claimant_amount + pending);
    user.pending_referral_rewards = 0; // æ¸…ç®—
}
```

##### ğŸ“Š å®Œå…¨ãªå‘½ä»¤ã‚»ãƒƒãƒˆ

| å‘½ä»¤å | ç›®çš„ | ä½¿ç”¨è€… | ã‚¿ã‚¤ãƒŸãƒ³ã‚° |
|--------|------|--------|------------|
| `accumulate_referral_reward` | ç´¹ä»‹æ–™è“„ç© | ã‚·ã‚¹ãƒ†ãƒ è‡ªå‹• | èª°ã‹ãŒclaimæ™‚ |
| `view_pending_referral_rewards` | è“„ç©é¡ç¢ºèª | ç´¹ä»‹è€… | ã„ã¤ã§ã‚‚ |
| `claim_reward_with_referral_rewards` | çµ±åˆclaim | å…¨ãƒ¦ãƒ¼ã‚¶ãƒ¼ | å®šæœŸçš„ |

### 6. ğŸ’ å ±é…¬åˆ†é…ã‚·ã‚¹ãƒ†ãƒ 

#### ğŸ§® æ ¸å¿ƒå…¬å¼

```rust
// æ¯”ä¾‹é…åˆ†ã«ã‚ˆã‚‹å…¬å¹³åˆ†é…
user_reward = (user_grow_power / global_grow_power) Ã— current_base_rate Ã— elapsed_time

// ä¾‹: ãƒ¦ãƒ¼ã‚¶ãƒ¼Grow Power 1000, ã‚°ãƒ­ãƒ¼ãƒãƒ«ç·è¨ˆ 10000, ãƒ¬ãƒ¼ãƒˆ 100 WEED/ç§’, çµŒéæ™‚é–“ 3600ç§’
// â†’ (1000/10000) Ã— 100 Ã— 3600 = 36,000 WEED = 0.036 WEEDï¼ˆ6æ¡ç²¾åº¦ï¼‰
```

#### ğŸ”„ é«˜åº¦ãªåŠæ¸›æœŸè·¨ãè¨ˆç®—

ã‚·ã‚¹ãƒ†ãƒ ã¯è¤‡æ•°ã®åŠæ¸›æœŸã«ã¾ãŸãŒã‚‹å ±é…¬è¨ˆç®—ã‚’ç²¾å¯†ã«å‡¦ç†ï¼š

```rust
// åŠæ¸›æœŸè·¨ãã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã«ã‚ˆã‚‹å…¬å¹³ãªå ±é…¬è¨ˆç®—
pub fn calculate_user_rewards_across_halving(
    user_grow_power: u64,         // ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®Grow Power
    global_grow_power: u64,       // ã‚°ãƒ­ãƒ¼ãƒãƒ«ç·Grow Power
    base_rate: u64,               // ç¾åœ¨ã®åŸºæœ¬ãƒ¬ãƒ¼ãƒˆ
    last_harvest_time: i64,       // æœ€çµ‚åç©«æ™‚åˆ»
    current_time: i64,            // ç¾åœ¨æ™‚åˆ»
    next_halving_time: i64,       // æ¬¡å›åŠæ¸›æœŸæ™‚åˆ»
    halving_interval: i64,        // åŠæ¸›æœŸé–“éš”ï¼ˆ7æ—¥ï¼‰
) -> Result<u64> {
    // æœŸé–“ã‚’åˆ†å‰²ã—ã¦å„ãƒ¬ãƒ¼ãƒˆã§æ­£ç¢ºè¨ˆç®—
    // å‰åŠæ¸›æœŸ + ç¾åŠæ¸›æœŸ = åˆè¨ˆå ±é…¬
}
```

#### ğŸ¯ å®Ÿè£…ä¾‹ã‚·ãƒŠãƒªã‚ª

```rust
// ã‚·ãƒŠãƒªã‚ª: åŠæ¸›æœŸã‚’è·¨ã7æ—¥é–“ã®å ±é…¬è«‹æ±‚
let user_grow_power = 5000;      // ãƒ¦ãƒ¼ã‚¶ãƒ¼: 5K GP
let global_grow_power = 100000;  // ã‚°ãƒ­ãƒ¼ãƒãƒ«: 100K GP
let base_rate = 100;             // åŸºæœ¬ãƒ¬ãƒ¼ãƒˆ: 100 WEED/ç§’

// æœŸé–“åˆ†å‰²:
// å‰åŠæ¸›æœŸã®æ®‹ã‚Š2æ—¥: ãƒ¬ãƒ¼ãƒˆ100ã§è¨ˆç®—
// å¾ŒåŠæ¸›æœŸã®5æ—¥: ãƒ¬ãƒ¼ãƒˆ50ã§è¨ˆç®—
// æœ€çµ‚å ±é…¬ = period1_reward + period2_reward
```

## ğŸ’° Economic Systems

### 1. Token Economics

#### WEED Token Specifications

- **Decimals**: 6
- **Total Supply**: 1,000,000,000 WEED
- **Mint Authority**: Program PDA
- **Initial Base Rate**: 100 WEED/second

#### Token Flows

```
â”Œâ”€ Reward Minting â”€â”€â†’ Users (proportional to grow power) [æ‰‹æ•°æ–™ãªã—]
â”œâ”€ Seed Pack Burn â”€â”€â†’ Null (deflationary) [100% burn]
â”œâ”€ Upgrade Burn â”€â”€â”€â”€â†’ Null (deflationary) [100% burn]
â”œâ”€ Trading Fees â”€â”€â”€â”€â†’ Fee Pool (2% of transfers) [ãƒ¦ãƒ¼ã‚¶ãƒ¼é–“è»¢é€ã®ã¿]
â””â”€ Referral Rewards â†’ Level 1 (10%), Level 2 (5%) [æ‰‹æ•°æ–™ãªã—]
```

#### ğŸ”„ æ‰‹æ•°æ–™ã‚·ã‚¹ãƒ†ãƒ è©³ç´°

##### **æ‰‹æ•°æ–™å¯¾è±¡å¤– (Fee-Free) æ“ä½œ**

```rust
// ç›´æ¥ãƒŸãƒ³ãƒˆæ–¹å¼ã«ã‚ˆã‚Šæ‰‹æ•°æ–™ãªã—
claim_reward()           // è¾²å ´å ±é…¬å—å– â†’ mint_to() ä½¿ç”¨
claim_referral_rewards() // ç´¹ä»‹å ±é…¬å—å– â†’ mint_to() ä½¿ç”¨
distribute_referral()    // ç´¹ä»‹å ±é…¬åˆ†é… â†’ mint_to() ä½¿ç”¨

// ç†ç”±: æ–°ãƒˆãƒ¼ã‚¯ãƒ³ä½œæˆã§ã‚ã‚Šã€æ—¢å­˜ãƒˆãƒ¼ã‚¯ãƒ³ã®ç§»å‹•ã§ã¯ãªã„
```

##### **æ‰‹æ•°æ–™å¯¾è±¡ (2% Fee) æ“ä½œ**

```rust
// Transferæ–¹å¼ã«ã‚ˆã‚Š2%æ‰‹æ•°æ–™ç™ºç”Ÿ
transfer_with_fee()           // ãƒ¦ãƒ¼ã‚¶ãƒ¼é–“é€é‡‘
transfer_with_improved_fee()  // æ”¹å–„ç‰ˆé€é‡‘ (FeePoolçµŒç”±)
trading_operations()          // å–å¼•ãƒ»äº¤æ›æ“ä½œ

// ç†ç”±: æ—¢å­˜ãƒˆãƒ¼ã‚¯ãƒ³ã®ç§»å‹•ãƒ»å–å¼•æ´»å‹•
```

#### âš¡ é‡è¦ãªæ„æ€æ±ºå®šãƒã‚¤ãƒ³ãƒˆ

### 300 WEED é–¾å€¤

```
é¸æŠè‚¢A: ãƒŸã‚¹ãƒ†ãƒªãƒ¼ãƒ‘ãƒƒã‚¯è³¼å…¥ï¼ˆé«˜ãƒªã‚¹ã‚¯ãƒ»é«˜ãƒªã‚¿ãƒ¼ãƒ³ï¼‰
é¸æŠè‚¢B: ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰è³‡é‡‘ã¨ã—ã¦è²¯è“„ï¼ˆç¢ºå®Ÿãªé€²æ­©ï¼‰
æœ€é©è§£: ç¾åœ¨ã®Grow Powerã¨ãƒªã‚¹ã‚¯è¨±å®¹åº¦ã«ä¾å­˜
```

### 3,500 WEED é–¾å€¤

```
é¸æŠè‚¢A: Level1â†’2ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ï¼ˆå®¹é‡100%å¢—åŠ ï¼‰
é¸æŠè‚¢B: 11-12å€‹ã®ãƒŸã‚¹ãƒ†ãƒªãƒ¼ãƒ‘ãƒƒã‚¯ï¼ˆæ½œåœ¨çš„å¤§å¹…æˆé•·ï¼‰
æœ€é©è§£: åŸºç›¤æ§‹ç¯‰ã¨ã—ã¦ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰å„ªå…ˆã€ãã®å¾Œãƒ‘ãƒƒã‚¯
```

#### ğŸ’¡ çµŒæ¸ˆè¨­è¨ˆæ€æƒ³

**Reward = æ–°ä¾¡å€¤å‰µé€  (æ‰‹æ•°æ–™ãªã—)**

- è¾²å ´å‚åŠ ã«ã‚ˆã‚‹ Grow Power è²¢çŒ®ã¸ã®å¯¾ä¾¡
- æ–°ã—ã„ WEED ãƒˆãƒ¼ã‚¯ãƒ³ã®ç›´æ¥ãƒŸãƒ³ãƒˆ
- ã‚²ãƒ¼ãƒ å‚åŠ ã¸ã®æ­£å½“ãªå ±é…¬

**Transfer = ä¾¡å€¤ç§»å‹• (æ‰‹æ•°æ–™ã‚ã‚Š)**

- æ—¢å­˜ãƒˆãƒ¼ã‚¯ãƒ³ã®æ‰€æœ‰æ¨©ç§»è»¢
- æŠ•æ©Ÿçš„å–å¼•æ´»å‹•ã¸ã®é©åˆ‡ãªèª²ç¨
- ã‚¨ã‚³ã‚·ã‚¹ãƒ†ãƒ æŒç¶šæ€§ã¸ã®è²¢çŒ®

### 2. Halving Mechanism

#### Halving Schedule

- **Default Interval**: 7 days (604,800 seconds)
- **Rate Reduction**: 50% each period
- **Progression**: 100 â†’ 50 â†’ 25 â†’ 12.5 â†’ 6.25...
- **Next Halving**: Tracked in global config
- **Cross-Period Rewards**: Advanced calculation preserves fairness

#### Implementation

```rust
pub fn check_and_apply_halving(
    current_time: i64,
    next_halving_time: i64,
    current_rate: u64,
    halving_interval: i64,
) -> (bool, u64, i64) {
    if current_time >= next_halving_time {
        let new_rate = current_rate / 2;
        let new_halving_time = next_halving_time + halving_interval;
        (true, new_rate, new_halving_time)
    } else {
        (false, current_rate, next_halving_time)
    }
}
```

### 3. Referral System

#### Multi-Level Structure

- **Level 1 Referrals**: 10% immediate distribution
- **Level 2 Referrals**: 5% pending accumulation
- **Protocol Exclusion**: Protocol addresses don't receive rewards
- **Tracking**: Full referral chain maintained

#### Invite Code System

- **Format**: 8-character alphanumeric codes
- **Uniqueness**: Enforced through PDA constraints
- **Usage Limits**: Default 5 invites per user (admin expandable)
- **Validation**: Comprehensive format and availability checks

## ğŸš€ Advanced Features

### 1. Pyth Entropy Integration

#### True Randomness for Fair Play

```rust
// Two-phase randomness process
Phase 1: purchase_seed_pack() â†’ request_pyth_entropy()
Phase 2: open_seed_pack() â†’ retrieve_entropy_result() â†’ generate_seeds()
```

#### Implementation Status

- âœ… **Framework**: Complete entropy request/response handling
- âš ï¸ **SDK Integration**: Pending full Pyth Entropy SDK integration
- âœ… **Fallback**: Deterministic randomness for development

### 2. Meteora DEX Integration

#### Fee Conversion System

```rust
// Convert accumulated WEED fees to SOL
convert_fees_to_sol(
    fee_amount: u64,
    minimum_sol_output: u64,
    slippage_tolerance: u16,
) -> Result<()>
```

#### Implementation Status

- âœ… **Framework**: Complete instruction structure
- âš ï¸ **Integration**: Pending Meteora SDK integration
- âœ… **Fee Collection**: Automated fee accumulation

### 3. Farm Space Upgrade System

#### Cooldown & Progression

- **Upgrade Process**: `start_farm_upgrade()` â†’ wait 24h â†’ `complete_farm_upgrade()`
- **Progression Tracking**: Target level and start time stored
- **Cost Validation**: Balance checks before upgrade initiation
- **Capacity Updates**: Automatic capacity increases on completion

## ğŸ“Š State Management

### Account Architecture

#### Core Accounts

```rust
// Global system state
pub struct Config {
    pub admin: Pubkey,
    pub treasury: Pubkey,
    pub protocol_referral_address: Pubkey,
    pub base_rate: u64,
    pub halving_interval: i64,
    pub next_halving_time: i64,
    pub seed_pack_cost: u64,
    pub farm_space_cost_sol: u64,
    // + counters, thresholds, reserves
}

// User progress tracking
pub struct UserState {
    pub owner: Pubkey,
    pub total_grow_power: u64,
    pub last_harvest_time: i64,
    pub has_farm_space: bool,
    pub referrer: Option<Pubkey>,
    pub pending_referral_rewards: u64,
    pub reserve: [u8; 32],
}

// Global statistics
pub struct GlobalStats {
    pub total_grow_power: u64,
    pub total_farm_spaces: u64,
    pub current_rewards_per_second: u64,
    pub last_update_time: i64,
    pub reserve: [u8; 32],
}
```

#### Account Size Optimization

All accounts include reserved bytes for future expansion:

- **Config**: 152 bytes + 48 byte reserve
- **UserState**: 122 bytes + 32 byte reserve
- **FarmSpace**: 82 bytes + 32 byte reserve
- **Seed**: 91 bytes + 16 byte reserve
- **SeedPack**: 97 bytes + 16 byte reserve

## ğŸ”’ Security & Validation

### Access Control Matrix

| Operation          | Admin | User Owner | Anyone |
| ------------------ | ----- | ---------- | ------ |
| Initialize Config  | âœ…    | âŒ         | âŒ     |
| Create User        | âŒ    | âœ…         | âŒ     |
| Buy Farm Space     | âŒ    | âœ…         | âŒ     |
| Claim Rewards      | âŒ    | âœ…         | âŒ     |
| Plant/Remove Seeds | âŒ    | âœ…         | âŒ     |
| View State         | âŒ    | âŒ         | âœ…     |

### Validation Patterns

```rust
// Comprehensive validation system
pub mod validation {
    // User validations
    pub fn validate_user_ownership(user_state: &UserState, expected_owner: Pubkey) -> Result<()>
    pub fn validate_has_farm_space(user_state: &UserState) -> Result<()>

    // Economic validations
    pub fn validate_sufficient_balance(balance: u64, required: u64) -> Result<()>
    pub fn validate_reward_amount(amount: u64) -> Result<()>

    // Business logic validations
    pub fn validate_farm_space_capacity(farm_space: &FarmSpace) -> Result<()>
    pub fn validate_seed_planting_request(seed: &Seed, farm_space: &FarmSpace, user_key: Pubkey) -> Result<()>
}
```

### Security Measures

- **Overflow Protection**: Checked arithmetic throughout
- **Access Control**: Comprehensive ownership and signature validation
- **Rate Limiting**: Minimum claim intervals, capacity constraints
- **Supply Protection**: Maximum reward limits (0.1% of total supply per claim)
- **Referrer Validation**: Self-referral and protocol address exclusion

## ğŸ“š Instructions Reference

### Admin Instructions

| Instruction               | Purpose                | Access |
| ------------------------- | ---------------------- | ------ |
| `initialize_config`       | System setup           | Admin  |
| `initialize_global_stats` | Stats initialization   | Admin  |
| `initialize_fee_pool`     | Fee pool setup         | Admin  |
| `create_reward_mint`      | WEED token creation    | Admin  |
| `update_config`           | Parameter updates      | Admin  |
| `expand_invite_limit`     | Invite limit increases | Admin  |

### User Instructions

| Instruction             | Purpose           | Requirements             | æ‰‹æ•°æ–™                  |
| ----------------------- | ----------------- | ------------------------ | ----------------------- |
| `init_user`             | User registration | Signature                | âŒ ãªã—                 |
| `buy_farm_space`        | Farm purchase     | 0.5 SOL, User exists     | âŒ ãªã—                 |
| `claim_reward`          | Reward collection | Farm space, Grow power   | âŒ **ãªã— (mint æ“ä½œ)** |
| `start_farm_upgrade`    | Begin upgrade     | WEED balance, Level < 5  | âŒ ãªã—                 |
| `complete_farm_upgrade` | Finish upgrade    | 24h cooldown passed      | âŒ ãªã—                 |
| `plant_seed`            | Seed planting     | Seed ownership, Capacity | âŒ ãªã—                 |
| `remove_seed`           | Seed removal      | Seed planted in farm     | âŒ ãªã—                 |

### Economy Instructions

| Instruction                    | Purpose             | Cost                | æ‰‹æ•°æ–™                  |
| ------------------------------ | ------------------- | ------------------- | ----------------------- |
| `purchase_seed_pack`           | Buy mystery pack    | 300 WEED (burned)   | âŒ ãªã— (burn æ“ä½œ)     |
| `open_seed_pack`               | Generate seeds      | Entropy available   | âŒ ãªã—                 |
| `transfer_with_fee`            | WEED user transfers | 2% fee              | âœ… **2% fee**           |
| `transfer_with_improved_fee`   | Enhanced transfers  | 2% fee (FeePool)    | âœ… **2% fee**           |
| `distribute_referral_on_claim` | Referral rewards    | Base reward         | âŒ **ãªã— (mint æ“ä½œ)** |
| `convert_fees_to_sol`          | Fee conversion      | Meteora integration | âŒ ãªã—                 |

#### ğŸ” æ‰‹æ•°æ–™è©³ç´°èª¬æ˜

##### **æ‰‹æ•°æ–™ãªã— (âŒ) ã®ç†ç”±**

- **Mint æ“ä½œ**: `claim_reward`, `distribute_referral` ã¯æ–°ãƒˆãƒ¼ã‚¯ãƒ³ä½œæˆ
- **Burn æ“ä½œ**: `purchase_seed_pack` ã¯æ—¢å­˜ãƒˆãƒ¼ã‚¯ãƒ³ç ´æ£„
- **ã‚·ã‚¹ãƒ†ãƒ æ“ä½œ**: ã‚²ãƒ¼ãƒ å†…æ©Ÿèƒ½ã¯æ‰‹æ•°æ–™å¯¾è±¡å¤–

##### **æ‰‹æ•°æ–™ã‚ã‚Š (âœ…) ã®å¯¾è±¡**

- **Transfer æ“ä½œ**: ãƒ¦ãƒ¼ã‚¶ãƒ¼é–“ã®æ—¢å­˜ãƒˆãƒ¼ã‚¯ãƒ³ç§»å‹•
- **å–å¼•æ´»å‹•**: æŠ•æ©Ÿçš„ãªä¾¡å€¤ç§»è»¢ã«å¯¾ã™ã‚‹èª²ç¨

## ğŸ“š å®Œå…¨å‘½ä»¤ã‚»ãƒƒãƒˆ

### ğŸ”§ ç®¡ç†è€…å°‚ç”¨å‘½ä»¤ï¼ˆAdmin Instructionsï¼‰

#### ã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–å‘½ä»¤
| å‘½ä»¤å | ç›®çš„ | å®Ÿè¡Œå›æ•°åˆ¶é™ | ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ | èª¬æ˜ |
|--------|------|-------------|------------|------|
| `initialize_config` | ã‚·ã‚¹ãƒ†ãƒ åŸºæœ¬è¨­å®š | 1å›ã®ã¿ | base_rate, halving_interval, treasury | ã‚²ãƒ¼ãƒ å…¨ä½“ã®åŸºæœ¬ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’è¨­å®š |
| `initialize_global_stats` | ã‚°ãƒ­ãƒ¼ãƒãƒ«çµ±è¨ˆåˆæœŸåŒ– | 1å›ã®ã¿ | initial_supply | ã‚·ã‚¹ãƒ†ãƒ å…¨ä½“ã®çµ±è¨ˆã‚¢ã‚«ã‚¦ãƒ³ãƒˆä½œæˆ |
| `initialize_fee_pool` | æ‰‹æ•°æ–™ãƒ—ãƒ¼ãƒ«åˆæœŸåŒ– | 1å›ã®ã¿ | treasury_address | å–å¼•æ‰‹æ•°æ–™åé›†ç”¨ã‚¢ã‚«ã‚¦ãƒ³ãƒˆä½œæˆ |
| `create_reward_mint` | WEEDãƒˆãƒ¼ã‚¯ãƒ³ä½œæˆ | 1å›ã®ã¿ | decimals=6 | å ±é…¬ãƒˆãƒ¼ã‚¯ãƒ³ãƒŸãƒ³ãƒˆä½œæˆ |

#### é‹å–¶ç®¡ç†å‘½ä»¤
| å‘½ä»¤å | ç›®çš„ | å®Ÿè¡Œåˆ¶é™ | ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ | èª¬æ˜ |
|--------|------|----------|------------|------|
| `update_config` | è¨­å®šå‹•çš„æ›´æ–° | ç„¡åˆ¶é™ | operator, base_rate, treasuryç­‰ | ã‚·ã‚¹ãƒ†ãƒ ç¨¼åƒä¸­ã®è¨­å®šå¤‰æ›´ |
| `expand_invite_limit` | æ‹›å¾…æ æ‹¡å¼µ | ç„¡åˆ¶é™ | user, additional_invites | ç‰¹å®šãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æ‹›å¾…é™åº¦æ‹¡å¼µ |

#### Meteoraçµ±åˆç®¡ç†å‘½ä»¤
| å‘½ä»¤å | ç›®çš„ | å®Ÿè¡Œåˆ¶é™ | ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ | èª¬æ˜ |
|--------|------|----------|------------|------|
| `initialize_meteora_config` | DEXçµ±åˆè¨­å®š | 1å›ã®ã¿ | pool_address, conversion_settings | Meteoraçµ±åˆåˆæœŸåŒ– |
| `configure_dlmm_pool` | ãƒ—ãƒ¼ãƒ«è¨­å®š | ç„¡åˆ¶é™ | pool_address, reserves | DLMMãƒ—ãƒ¼ãƒ«è©³ç´°è¨­å®š |
| `update_conversion_settings` | å¤‰æ›è¨­å®šæ›´æ–° | ç„¡åˆ¶é™ | slippage, intervals | è‡ªå‹•å¤‰æ›ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿èª¿æ•´ |
| `emergency_pause_toggle` | ç·Šæ€¥åˆ¶å¾¡ | ç„¡åˆ¶é™ | pause_state | ã‚·ã‚¹ãƒ†ãƒ ä¸€æ™‚åœæ­¢ãƒ»å†é–‹ |

### ğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼åŸºæœ¬å‘½ä»¤ï¼ˆUser Core Instructionsï¼‰

#### ã‚¢ã‚«ã‚¦ãƒ³ãƒˆç®¡ç†å‘½ä»¤
| å‘½ä»¤å | ç›®çš„ | å¿…è¦æ¡ä»¶ | ã‚³ã‚¹ãƒˆ | æ‰‹æ•°æ–™ | èª¬æ˜ |
|--------|------|----------|--------|--------|------|
| `init_user` | ãƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ² | ç½²åã®ã¿ | ç„¡æ–™ | âŒ ãªã— | åˆå›ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¢ã‚«ã‚¦ãƒ³ãƒˆä½œæˆ |
| `initialize_seed_storage` | ç¨®åœ¨åº«åˆæœŸåŒ– | ãƒ¦ãƒ¼ã‚¶ãƒ¼å­˜åœ¨ | ã‚¢ã‚«ã‚¦ãƒ³ãƒˆä½œæˆè²» | âŒ ãªã— | ç¨®ä¿ç®¡ç”¨ã‚¢ã‚«ã‚¦ãƒ³ãƒˆä½œæˆ |

#### è¾²å ´ã‚·ã‚¹ãƒ†ãƒ å‘½ä»¤
| å‘½ä»¤å | ç›®çš„ | å¿…è¦æ¡ä»¶ | ã‚³ã‚¹ãƒˆ | æ‰‹æ•°æ–™ | èª¬æ˜ |
|--------|------|----------|--------|--------|------|
| `buy_farm_space` | è¾²å ´è³¼å…¥ | 0.5 SOL + ãƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ²æ¸ˆã¿ | 0.5 SOL | âŒ ãªã— | ãƒ¬ãƒ™ãƒ«1è¾²å ´ + ç„¡æ–™Seed1ä»˜ä¸ |
| `start_farm_upgrade` | ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰é–‹å§‹ | WEEDæ®‹é«˜ + ãƒ¬ãƒ™ãƒ«<5 | 3,500-25,000 WEED | âŒ ãªã— | 24æ™‚é–“ã‚¯ãƒ¼ãƒ«ãƒ€ã‚¦ãƒ³é–‹å§‹ |
| `complete_farm_upgrade` | ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰å®Œäº† | 24æ™‚é–“çµŒé | ç„¡æ–™ | âŒ ãªã— | å®¹é‡å¢—åŠ ã¨ãƒ¬ãƒ™ãƒ«ã‚¢ãƒƒãƒ— |

#### ç¨®ç®¡ç†å‘½ä»¤
| å‘½ä»¤å | ç›®çš„ | å¿…è¦æ¡ä»¶ | ã‚³ã‚¹ãƒˆ | æ‰‹æ•°æ–™ | èª¬æ˜ |
|--------|------|----------|--------|--------|------|
| `plant_seed` | ç¨®æ¤ãˆä»˜ã‘ | ç¨®æ‰€æœ‰ + è¾²å ´å®¹é‡ | ç„¡æ–™ | âŒ ãªã— | è¾²å ´ã«ç¨®ã‚’æ¤ãˆä»˜ã‘ |
| `remove_seed` | ç¨®é™¤å» | ç¨®ãŒè¾²å ´ã«æ¤ãˆä»˜ã‘æ¸ˆã¿ | ç„¡æ–™ | âŒ ãªã— | è¾²å ´ã‹ã‚‰ç¨®ã‚’é™¤å» |
| `discard_seed` | ç¨®å»ƒæ£„ | ç¨®æ‰€æœ‰ + æœªæ¤ãˆä»˜ã‘ | ç„¡æ–™ | âŒ ãªã— | ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‹ã‚‰ç¨®ã‚’æ°¸ä¹…å‰Šé™¤ + rentå›å |
| `batch_discard_seeds` | ä¸€æ‹¬ç¨®å»ƒæ£„ | è¤‡æ•°ç¨®æ‰€æœ‰ + æœªæ¤ãˆä»˜ã‘ | ç„¡æ–™ | âŒ ãªã— | æœ€å¤§100ç¨®åŒæ™‚å»ƒæ£„ + rentä¸€æ‹¬å›å |

### ğŸ’° çµŒæ¸ˆã‚·ã‚¹ãƒ†ãƒ å‘½ä»¤ï¼ˆEconomic Instructionsï¼‰

#### å ±é…¬ã‚·ã‚¹ãƒ†ãƒ å‘½ä»¤
| å‘½ä»¤å | ç›®çš„ | å¿…è¦æ¡ä»¶ | ã‚³ã‚¹ãƒˆ | æ‰‹æ•°æ–™ | èª¬æ˜ |
|--------|------|----------|--------|--------|------|
| `claim_reward` | å ±é…¬è«‹æ±‚ | è¾²å ´æ‰€æœ‰ + Grow Power>0 | ç„¡æ–™ | âŒ **ãªã— (mintæ“ä½œ)** | æ™‚é–“çµŒéã«ã‚ˆã‚‹å ±é…¬å—å– |
| `distribute_referral_on_claim` | ç´¹ä»‹å ±é…¬åˆ†é… | ç´¹ä»‹é–¢ä¿‚å­˜åœ¨ | ç„¡æ–™ | âŒ **ãªã— (mintæ“ä½œ)** | L1(10%)å ±é…¬åˆ†é… |
| `distribute_complete_referral` | å®Œå…¨ç´¹ä»‹åˆ†é… | ç´¹ä»‹ãƒã‚§ãƒ¼ãƒ³å­˜åœ¨ | ç„¡æ–™ | âŒ **ãªã— (mintæ“ä½œ)** | L1(10%) + L2(5%)å®Œå…¨åˆ†é… |
| `claim_referral_rewards` | ç´¹ä»‹å ±é…¬è«‹æ±‚ | æœªè«‹æ±‚å ±é…¬>0 | ç„¡æ–™ | âŒ **ãªã— (mintæ“ä½œ)** | è“„ç©ã•ã‚ŒãŸç´¹ä»‹å ±é…¬å—å– |

#### ãƒŸã‚¹ãƒ†ãƒªãƒ¼ãƒ‘ãƒƒã‚¯ã‚·ã‚¹ãƒ†ãƒ å‘½ä»¤
| å‘½ä»¤å | ç›®çš„ | å¿…è¦æ¡ä»¶ | ã‚³ã‚¹ãƒˆ | æ‰‹æ•°æ–™ | ãƒãƒƒãƒå¯¾å¿œ |
|--------|------|----------|--------|--------|----------|
| `purchase_seed_pack` | ãƒ‘ãƒƒã‚¯è³¼å…¥ | WEEDæ®‹é«˜â‰¥300Ã—æ•°é‡ | 300 WEED/pack | âŒ ãªã— (burnæ“ä½œ) | âœ… **æœ€å¤§100å€‹åŒæ™‚** |
| `open_seed_pack` | ãƒ‘ãƒƒã‚¯é–‹å° | ã‚¨ãƒ³ãƒˆãƒ­ãƒ”ãƒ¼æº–å‚™å®Œäº† | ç„¡æ–™ | âŒ ãªã— | âœ… è¤‡æ•°ãƒ‘ãƒƒã‚¯åŒæ™‚é–‹å° |
| `discard_seed` | ç¨®å»ƒæ£„ | ç¨®æ‰€æœ‰ + æœªæ¤ãˆä»˜ã‘ | ç„¡æ–™ | âŒ ãªã— | âŒ å€‹åˆ¥å‰Šé™¤ã®ã¿ |
| `batch_discard_seeds` | ä¸€æ‹¬å»ƒæ£„ | è¤‡æ•°ç¨®æ‰€æœ‰ + æœªæ¤ãˆä»˜ã‘ | ç„¡æ–™ | âŒ ãªã— | âœ… **æœ€å¤§100ç¨®åŒæ™‚** |

**ãƒŸã‚¹ãƒ†ãƒªãƒ¼ãƒ‘ãƒƒã‚¯å¤§é‡è³¼å…¥ä»•æ§˜**:
```rust
// æœ€å¤§100ãƒ‘ãƒƒã‚¯åŒæ™‚è³¼å…¥å¯èƒ½
purchase_seed_pack(quantity: u8) // 1-100
// ç”Ÿæˆã•ã‚Œã‚‹ç¨®æ•°: quantity Ã— 5 = æœ€å¤§500ç¨®
// å¿…è¦WEED: quantity Ã— 300 = æœ€å¤§30,000 WEED
// æ‰€è¦æ™‚é–“: 1å›ã®ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ï¼ˆç´„2-3ç§’ï¼‰
// ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ä½™è£•: 1,000ç¨®å®¹é‡ãªã®ã§500ç¨®ç”Ÿæˆã§ã‚‚ä½™è£•
```

#### å–å¼•ãƒ»è»¢é€å‘½ä»¤
| å‘½ä»¤å | ç›®çš„ | å¿…è¦æ¡ä»¶ | ã‚³ã‚¹ãƒˆ | æ‰‹æ•°æ–™ | èª¬æ˜ |
|--------|------|----------|--------|--------|------|
| `transfer_with_fee` | ãƒ¦ãƒ¼ã‚¶ãƒ¼é–“é€é‡‘ | WEEDæ®‹é«˜â‰¥é€é‡‘é¡ | ç„¡æ–™ | âœ… **2% fee (Treasury)** | ãƒ¬ã‚¬ã‚·ãƒ¼é€é‡‘ã‚·ã‚¹ãƒ†ãƒ  |
| `transfer_with_improved_fee` | æ”¹å–„ç‰ˆé€é‡‘ | WEEDæ®‹é«˜â‰¥é€é‡‘é¡ | ç„¡æ–™ | âœ… **2% fee (FeePool)** | Meteoraçµ±åˆå¯¾å¿œé€é‡‘ |
| `batch_transfer_with_fee` | ãƒãƒƒãƒé€é‡‘ | è¤‡æ•°å—ä¿¡è€…æŒ‡å®š | ç„¡æ–™ | âœ… **2% fee** | æœ€å¤§10ä»¶åŒæ™‚é€é‡‘ |

#### DEXçµ±åˆå‘½ä»¤
| å‘½ä»¤å | ç›®çš„ | å¿…è¦æ¡ä»¶ | ã‚³ã‚¹ãƒˆ | æ‰‹æ•°æ–™ | èª¬æ˜ |
|--------|------|----------|--------|--------|------|
| `convert_fees_to_sol` | æ‰‹æ•°æ–™å¤‰æ› | FeePoolæ®‹é«˜>é–¾å€¤ | ç„¡æ–™ | âŒ ãªã— | WEEDâ†’SOLè‡ªå‹•å¤‰æ› |
| `manual_conversion_with_slippage` | æ‰‹å‹•å¤‰æ› | ç®¡ç†è€…æ¨©é™ | ç„¡æ–™ | âŒ ãªã— | ã‚¹ãƒªãƒƒãƒšãƒ¼ã‚¸æŒ‡å®šå¤‰æ› |

### ğŸŸï¸ æ‹›å¾…ã‚·ã‚¹ãƒ†ãƒ å‘½ä»¤ï¼ˆInvite System Instructionsï¼‰

| å‘½ä»¤å | ç›®çš„ | åˆ¶é™ | ã‚³ã‚¹ãƒˆ | ç‰¹åˆ¥æ¨©é™ | èª¬æ˜ |
|--------|------|------|--------|----------|------|
| `create_invite_code` | æ‹›å¾…ã‚³ãƒ¼ãƒ‰ç”Ÿæˆ | ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ5å› | ã‚¢ã‚«ã‚¦ãƒ³ãƒˆä½œæˆè²» | Operator=ç„¡åˆ¶é™ | 8æ–‡å­—ã‚³ãƒ¼ãƒ‰ç”Ÿæˆ |
| `use_invite_code` | æ‹›å¾…ã‚³ãƒ¼ãƒ‰ä½¿ç”¨ | ã‚³ãƒ¼ãƒ‰åˆ©ç”¨å¯èƒ½ | ç„¡æ–™ | - | ç´¹ä»‹é–¢ä¿‚ç¢ºç«‹ |
| `expand_invite_limit` | æ‹›å¾…æ æ‹¡å¼µ | ç®¡ç†è€…æ¨©é™ | ç„¡æ–™ | Adminæ“ä½œ | ç‰¹å®šãƒ¦ãƒ¼ã‚¶ãƒ¼æ å¢—åŠ  |

#### ğŸ¢ é‹å–¶ç›´æ¥æ‹›å¾…ã‚·ã‚¹ãƒ†ãƒ ï¼ˆOperator Direct Invitationï¼‰

é‹å–¶ï¼ˆOperatorï¼‰ã¯ç‰¹åˆ¥ãªæ¨©é™ã«ã‚ˆã‚Šã€æ‹›å¾…ã‚³ãƒ¼ãƒ‰ã‚’ä»‹ã•ãšã«ç›´æ¥ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’æ‹›å¾…ã§ãã¾ã™ã€‚ã“ã®å ´åˆã€è¢«æ‹›å¾…ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ç´¹ä»‹æ–™è² æ‹…ãªã—ã§ãƒ—ãƒ¬ã‚¤ãŒå¯èƒ½ã§ã™ã€‚

##### **é‹å–¶æ‹›å¾… vs é€šå¸¸æ‹›å¾…ã®æ¯”è¼ƒ**

| é …ç›® | é‹å–¶æ‹›å¾… | é€šå¸¸æ‹›å¾… |
|------|----------|----------|
| **æ‹›å¾…æ–¹æ³•** | ã‚¢ãƒ‰ãƒ¬ã‚¹ç›´æ¥æŒ‡å®š | 8æ–‡å­—æ‹›å¾…ã‚³ãƒ¼ãƒ‰ |
| **æ‹›å¾…ä¸Šé™** | ç„¡åˆ¶é™ | ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ5äºº |
| **ç´¹ä»‹æ–™è² æ‹…** | **0%ï¼ˆãªã—ï¼‰** | 15%ï¼ˆL1: 10%, L2: 5%ï¼‰ |
| **å®Ÿè£…æ–¹å¼** | `referrer = protocol_referral_address` | `referrer = inviter_address` |

##### **ç´¹ä»‹æ–™å…é™¤ãƒ¡ã‚«ãƒ‹ã‚ºãƒ **

```rust
// rewards.rs æŠœç²‹
fn process_referral_rewards(ctx: &Context<ClaimReward>, base_reward: u64) -> Result<()> {
    // é‹å–¶æ‹›å¾…ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ç´¹ä»‹æ–™ãªã—
    if ctx.accounts.user.key() == ctx.accounts.config.protocol_referral_address {
        msg!("ğŸ¢ Protocol address claimed: {} WEED (100% retention)", base_reward);
        return Ok(()); // ç´¹ä»‹æ–™åˆ†é…ã‚’ã‚¹ã‚­ãƒƒãƒ—
    }
    
    // é€šå¸¸æ‹›å¾…ã®å ´åˆã®ã¿ç´¹ä»‹æ–™åˆ†é…
    if let Some(level1_referrer_key) = ctx.accounts.user_state.referrer {
        let (level1_reward, level2_reward) = calculate_referral_rewards(base_reward)?;
        // L1: 10%, L2: 5% ã®åˆ†é…å‡¦ç†
    }
}
```

##### **å®Ÿè£…ä¸Šã®åˆ©ç‚¹**

1. **ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½“é¨“å‘ä¸Š**: æ–°è¦ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ç´¹ä»‹æ–™è² æ‹…ãªã—
2. **é‹å–¶ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«**: ç‰¹åˆ¥ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ç›´æ¥ç®¡ç†
3. **ã‚·ã‚¹ãƒ†ãƒ çµ±ä¸€æ€§**: æ—¢å­˜ã®ç´¹ä»‹ã‚·ã‚¹ãƒ†ãƒ ã‚’æµç”¨
4. **é€æ˜æ€§**: ã‚ªãƒ³ãƒã‚§ãƒ¼ãƒ³ã§æ¤œè¨¼å¯èƒ½

### ğŸ“Š çµ±è¨ˆãƒ»ç›£è¦–å‘½ä»¤ï¼ˆMonitoring Instructionsï¼‰

| å‘½ä»¤å | ç›®çš„ | ã‚¢ã‚¯ã‚»ã‚¹æ¨©é™ | å®Ÿè¡Œé »åº¦ | èª¬æ˜ |
|--------|------|-------------|----------||------|
| `update_global_stats` | çµ±è¨ˆæ›´æ–° | ã‚·ã‚¹ãƒ†ãƒ è‡ªå‹• | å„æ“ä½œæ™‚ | Grow Powerç­‰ã®çµ±è¨ˆæ›´æ–° |
| `monitor_pool_health` | ãƒ—ãƒ¼ãƒ«ç›£è¦– | ç®¡ç†è€… | éšæ™‚ | Meteoraæµå‹•æ€§ç›£è¦– |
| `get_user_summary` | ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±å–å¾— | èª°ã§ã‚‚ï¼ˆèª­ã¿å–ã‚Šï¼‰ | ç„¡åˆ¶é™ | å…¬é–‹çµ±è¨ˆæƒ…å ±è¡¨ç¤º |

### ğŸ” ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ»ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³

#### ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡ãƒãƒˆãƒªãƒƒã‚¯ã‚¹
| æ“ä½œã‚«ãƒ†ã‚´ãƒª | Admin | User Owner | Operator | Anyone |
|-------------|-------|-----------|----------|--------|
| **ã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–** | âœ… | âŒ | âŒ | âŒ |
| **è¨­å®šå¤‰æ›´** | âœ… | âŒ | âŒ | âŒ |
| **ç·Šæ€¥åˆ¶å¾¡** | âœ… | âŒ | âŒ | âŒ |
| **ãƒ¦ãƒ¼ã‚¶ãƒ¼æ“ä½œ** | âŒ | âœ… | âŒ | âŒ |
| **æ‹›å¾…ã‚·ã‚¹ãƒ†ãƒ ** | âœ… | âœ… | âœ…ç„¡åˆ¶é™ | âŒ |
| **çµ±è¨ˆé–²è¦§** | âœ… | âœ… | âœ… | âœ… |

#### é‡è¦ãªãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³

```rust
// å…¨å‘½ä»¤å…±é€šã®åŸºæœ¬ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
1. ã‚¢ã‚«ã‚¦ãƒ³ãƒˆæ‰€æœ‰æ¨©æ¤œè¨¼
2. ç½²åæ¤œè¨¼
3. PDAã‚¢ãƒ‰ãƒ¬ã‚¹æ¤œè¨¼
4. æ®‹é«˜ãƒ»å®¹é‡åˆ¶é™ãƒã‚§ãƒƒã‚¯
5. ã‚ªãƒ¼ãƒãƒ¼ãƒ•ãƒ­ãƒ¼é˜²æ­¢

// çµŒæ¸ˆå‘½ä»¤ã®è¿½åŠ ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
1. æœ€å°/æœ€å¤§é‡‘é¡åˆ¶é™
2. ä¾›çµ¦é‡ä¸Šé™ãƒã‚§ãƒƒã‚¯ï¼ˆ0.1%/å›ï¼‰
3. ã‚¯ãƒ¼ãƒ«ãƒ€ã‚¦ãƒ³æœŸé–“ç¢ºèª
4. é‡è¤‡å®Ÿè¡Œé˜²æ­¢

// ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å‘½ä»¤ã®ç‰¹åˆ¥ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
1. ç®¡ç†è€…æ¨©é™ç¢ºèª
2. ç·Šæ€¥çŠ¶æ…‹ãƒã‚§ãƒƒã‚¯
3. è¨­å®šå¤‰æ›´å±¥æ­´è¨˜éŒ²
4. ã‚¤ãƒ™ãƒ³ãƒˆãƒ­ã‚°ç™ºè¡Œ
```

### ğŸ“ˆ ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æŒ‡æ¨™

#### Gasä½¿ç”¨é‡ï¼ˆæ¦‚ç®—ï¼‰
| å‘½ä»¤ã‚«ãƒ†ã‚´ãƒª | åŸºæœ¬Gas | è¤‡é›‘åº¦ | æœ€é©åŒ–ãƒ¬ãƒ™ãƒ« |
|-------------|---------|--------|-------------|
| **åŸºæœ¬æ“ä½œ** | 5,000-15,000 | ä½ | é«˜ |
| **è¾²å ´æ“ä½œ** | 15,000-25,000 | ä¸­ | é«˜ |
| **ãƒŸã‚¹ãƒ†ãƒªãƒ¼ãƒ‘ãƒƒã‚¯** | 25,000-40,000 | é«˜ | ä¸­ |
| **ç®¡ç†è€…æ“ä½œ** | 10,000-30,000 | ä¸­ | é«˜ |
| **DEXçµ±åˆ** | 40,000-60,000 | æœ€é«˜ | ä¸­ |

#### åŒæ™‚å®Ÿè¡Œåˆ¶é™
```rust
// ã‚·ã‚¹ãƒ†ãƒ è¨­è¨ˆä¸Šã®åˆ¶é™
ãƒŸã‚¹ãƒ†ãƒªãƒ¼ãƒ‘ãƒƒã‚¯åŒæ™‚è³¼å…¥: 100å€‹/ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³
ãƒãƒƒãƒè»¢é€: 10ä»¶/ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³
ç¨®åœ¨åº«: 1,000ç¨®/ã‚¢ã‚«ã‚¦ãƒ³ãƒˆï¼ˆå®Ÿè£…æ¸ˆã¿ï¼‰ğŸ’°
è¾²å ´å®¹é‡: 20ç¨®/è¾²å ´ï¼ˆæœ€å¤§ãƒ¬ãƒ™ãƒ«ï¼‰
```

#### ğŸ” æ‰‹æ•°æ–™ã‚·ã‚¹ãƒ†ãƒ å®Œå…¨è§£èª¬

##### **æ‰‹æ•°æ–™ãªã— (âŒ) ã®ç†ç”±**
- **Mintæ“ä½œ**: `claim_reward`, `distribute_referral`ã¯æ–°ãƒˆãƒ¼ã‚¯ãƒ³ä½œæˆ
- **Burnæ“ä½œ**: `purchase_seed_pack`ã¯æ—¢å­˜ãƒˆãƒ¼ã‚¯ãƒ³ç ´æ£„
- **ã‚·ã‚¹ãƒ†ãƒ æ“ä½œ**: ã‚²ãƒ¼ãƒ å†…æ©Ÿèƒ½ã¯æ‰‹æ•°æ–™å¯¾è±¡å¤–
- **å ±é…¬ãƒ¡ã‚«ãƒ‹ã‚ºãƒ **: ã‚²ãƒ¼ãƒ å‚åŠ ã¸ã®æ­£å½“ãªå¯¾ä¾¡

##### **æ‰‹æ•°æ–™ã‚ã‚Š (âœ…) ã®å¯¾è±¡**
- **Transferæ“ä½œ**: ãƒ¦ãƒ¼ã‚¶ãƒ¼é–“ã®æ—¢å­˜ãƒˆãƒ¼ã‚¯ãƒ³ç§»å‹•
- **å–å¼•æ´»å‹•**: æŠ•æ©Ÿçš„ãªä¾¡å€¤ç§»è»¢ã«å¯¾ã™ã‚‹èª²ç¨
- **æµå‹•æ€§ç¢ºä¿**: ã‚¨ã‚³ã‚·ã‚¹ãƒ†ãƒ æŒç¶šæ€§ã¸ã®è²¢çŒ®

## ğŸ”„ é–‹ç™ºçŠ¶æ³

### âœ… å®Œäº†æ¸ˆã¿æ©Ÿèƒ½

- **ğŸ® ã‚³ã‚¢ã‚²ãƒ¼ãƒ ãƒ«ãƒ¼ãƒ—**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ â†’ è¾²å ´ â†’ ç¨® â†’ å ±é…¬ã®å®Œå…¨å®Ÿè£…
- **âš¡ çµŒæ¸ˆã‚¨ãƒ³ã‚¸ãƒ³**: åŠæ¸›æœŸãƒ¡ã‚«ãƒ‹ã‚ºãƒ ã¨è·¨æœŸè¨ˆç®—ã«ã‚ˆã‚‹é«˜åº¦ãªå ±é…¬ã‚·ã‚¹ãƒ†ãƒ 
- **ğŸ¤ ç´¹ä»‹ã‚·ã‚¹ãƒ†ãƒ **: Level 1 å®Ÿè£…ã¨å³æ™‚å ±é…¬åˆ†é…æ©Ÿèƒ½
- **ğŸŒ± ç¨®ã‚·ã‚¹ãƒ†ãƒ **: 9 æ®µéšãƒ¬ã‚¢ãƒªãƒ†ã‚£ã¨ç¢ºç‡ãƒ™ãƒ¼ã‚¹ç”Ÿæˆã‚·ã‚¹ãƒ†ãƒ 
- **ğŸ¡ è¾²å ´ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰**: 5 æ®µéšé€²è¡Œã¨ã‚¯ãƒ¼ãƒ«ãƒ€ã‚¦ãƒ³ã‚·ã‚¹ãƒ†ãƒ 
- **ğŸŸï¸ æ‹›å¾…ã‚·ã‚¹ãƒ†ãƒ **: ã‚³ãƒ¼ãƒ‰ç”Ÿæˆã¨ä½¿ç”¨è¿½è·¡æ©Ÿèƒ½
- **ğŸ” ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯**: åŒ…æ‹¬çš„æ¤œè¨¼ã¨ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡
- **ğŸ’° ãƒˆãƒ¼ã‚¯ãƒ³ã‚¨ã‚³ãƒãƒŸã‚¯ã‚¹**: ãƒŸãƒ³ãƒˆã€ç‡ƒç„¼ã€æ‰‹æ•°æ–™åé›†æ©Ÿèƒ½

### âš ï¸ å®Ÿè£…äºˆå®šæ©Ÿèƒ½

- **ğŸª Meteora çµ±åˆ**: DEX çµ±åˆã«ã‚ˆã‚‹å®Œå…¨ãªæ‰‹æ•°æ–™å¤‰æ›æ©Ÿèƒ½
- **ğŸ‘¥ Level 2 ç´¹ä»‹**: Level 2 ç´¹ä»‹å ±é…¬ã®åˆ†é…å®Ÿè£…
- **ğŸ² Pyth Entropy SDK**: å®Œå…¨ãª SDK çµ±åˆï¼ˆç¾åœ¨ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ä½¿ç”¨ï¼‰
- **ğŸ“Š é«˜åº¦åˆ†æ**: ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰çµ±åˆã®ãŸã‚ã®æ‹¡å¼µã‚¤ãƒ™ãƒ³ãƒˆç™ºè¡Œ
- **âš¡ ã‚¹ãƒªãƒƒãƒšãƒ¼ã‚¸ä¿è­·**: é«˜åº¦ãªå–å¼•ä¿è­·æ©Ÿèƒ½

## ğŸŒŠ Meteoraçµ±åˆ å®Ÿè£…è¨ˆç”»

### ğŸ“‹ çµ±åˆæ¦‚è¦

Facility Gameã¨Meteora DLMMï¼ˆDynamic Liquidity Market Makerï¼‰ã®çµ±åˆã«ã‚ˆã‚Šã€**æ‰‹æ•°æ–™ã®è‡ªå‹•WEEDâ†’SOLå¤‰æ›ã‚·ã‚¹ãƒ†ãƒ **ã‚’å®Ÿç¾ã—ã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šå–å¼•æ‰‹æ•°æ–™ã®åŠ¹ç‡çš„ãªä¾¡å€¤å®Ÿç¾ã¨ã€ã‚²ãƒ¼ãƒ çµŒæ¸ˆã®æŒç¶šå¯èƒ½æ€§ã‚’å‘ä¸Šã•ã›ã¾ã™ã€‚

### ğŸ—ï¸ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£è¨­è¨ˆ

#### æ–°ã—ã„æ‰‹æ•°æ–™ãƒ•ãƒ­ãƒ¼
```
ãƒ¦ãƒ¼ã‚¶ãƒ¼å–å¼• â†’ 2%æ‰‹æ•°æ–™ â†’ FeePoolè“„ç© â†’ é–¾å€¤åˆ°é” â†’ Meteora DLMMè‡ªå‹•å¤‰æ› â†’ SOL â†’ Treasury
                â†“
            å¾“æ¥: ç›´æ¥Treasury
            æ”¹å–„: FeePool â†’ ãƒãƒƒãƒå¤‰æ› â†’ åŠ¹ç‡åŒ–
```

#### æ®µéšçš„å®Ÿè£…ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ
```rust
Phase 1: åŸºæœ¬çµ±åˆ (2-3é€±é–“)
â”œâ”€â”€ FeePoolçµŒç”±ã®æ‰‹æ•°æ–™åé›†
â”œâ”€â”€ åŸºæœ¬Meteoraè¨­å®šç®¡ç†
â””â”€â”€ æ‰‹å‹•å¤‰æ›æ©Ÿèƒ½

Phase 2: é«˜åº¦æ©Ÿèƒ½ (3-4é€±é–“)  
â”œâ”€â”€ è‡ªå‹•å¤‰æ›ã‚·ã‚¹ãƒ†ãƒ 
â”œâ”€â”€ ã‚¹ãƒªãƒƒãƒšãƒ¼ã‚¸ä¿è­·
â”œâ”€â”€ ç·Šæ€¥åœæ­¢æ©Ÿèƒ½
â””â”€â”€ ç®¡ç†è€…åˆ¶å¾¡ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰

Phase 3: æœ€é©åŒ– (1-2é€±é–“)
â”œâ”€â”€ ãƒãƒƒãƒå¤‰æ›åŠ¹ç‡åŒ–
â”œâ”€â”€ ã‚¬ã‚¹æœ€é©åŒ–
â”œâ”€â”€ çµ±è¨ˆãƒ»ç›£è¦–å¼·åŒ–
â””â”€â”€ ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰çµ±åˆ
```

### ğŸ“ å®Ÿè£…ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆ

#### âœ… å®Ÿè£…æ¸ˆã¿
```
instructions/meteora.rs           - åŸºæœ¬DEXçµ±åˆãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯
instructions/transfer_improved.rs - FeePoolå¯¾å¿œè»¢é€ã‚·ã‚¹ãƒ†ãƒ 
state_meteora.rs                 - Meteoraå°‚ç”¨ãƒ‡ãƒ¼ã‚¿æ§‹é€ 
```

#### ğŸ”„ å®Ÿè£…äºˆå®šï¼ˆã‚³ãƒ¡ãƒ³ãƒˆã‚¢ã‚¦ãƒˆçŠ¶æ…‹ï¼‰
```
instructions/meteora_admin.rs     - åŒ…æ‹¬çš„ç®¡ç†è€…åˆ¶å¾¡ã‚·ã‚¹ãƒ†ãƒ 
instructions/meteora_advanced.rs  - é«˜åº¦DLMMçµ±åˆã¨ã‚¹ãƒªãƒƒãƒšãƒ¼ã‚¸ä¿è­·
instructions/meteora_minimal.rs   - è»½é‡å¤‰æ›ã‚·ã‚¹ãƒ†ãƒ 
```

### ğŸ”§ ä¸»è¦æ©Ÿèƒ½è¨­è¨ˆ

#### 1. è‡ªå‹•å¤‰æ›ã‚·ã‚¹ãƒ†ãƒ 
```rust
pub struct AutoConversionTrigger {
    threshold: 5000 * 1_000_000,    // 5,000 WEEDé–¾å€¤
    min_interval: 3600,             // 1æ™‚é–“é–“éš”
    slippage_protection: 100,       // 1%ã‚¹ãƒªãƒƒãƒšãƒ¼ã‚¸ä¿è­·
}

// è‡ªå‹•å¤‰æ›æ¡ä»¶
if fee_pool.accumulated_fees >= threshold &&
   current_time - last_conversion >= min_interval {
    execute_dlmm_conversion();
}
```

#### 2. ç·Šæ€¥åˆ¶å¾¡æ©Ÿèƒ½
```rust
// ç®¡ç†è€…ã«ã‚ˆã‚‹å³åº§ã‚·ã‚¹ãƒ†ãƒ åˆ¶å¾¡
emergency_pause_toggle(pause: bool)     // ç·Šæ€¥åœæ­¢ãƒ»å†é–‹
update_conversion_settings(settings)   // ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ è¨­å®šå¤‰æ›´
monitor_pool_health()                  // æµå‹•æ€§ç›£è¦–
```

#### 3. çµ±è¨ˆãƒ»ç›£è¦–ã‚·ã‚¹ãƒ†ãƒ 
```rust
pub struct MeteoraStats {
    total_conversions: u64,           // ç·å¤‰æ›å›æ•°
    total_weed_converted: u64,        // ç·å¤‰æ›WEEDé‡
    total_sol_received: u64,          // ç·å—å–SOLé‡
    average_conversion_rate: u64,     // å¹³å‡å¤‰æ›ãƒ¬ãƒ¼ãƒˆ
    pool_health_status: bool,         // ãƒ—ãƒ¼ãƒ«å¥å…¨æ€§
}
```

### ğŸ’¡ çµŒæ¸ˆåŠ¹æœ

#### åŠ¹ç‡åŒ–ã®ãƒ¡ãƒªãƒƒãƒˆ
```
å¾“æ¥: å€‹åˆ¥2%æ‰‹æ•°æ–™ â†’ å³åº§Treasuryé€é‡‘ â†’ ã‚¬ã‚¹éåŠ¹ç‡
æ”¹å–„: æ‰‹æ•°æ–™è“„ç© â†’ ãƒãƒƒãƒå¤‰æ› â†’ 30%ã‚¬ã‚¹å‰Šæ¸›æœŸå¾…
```

#### ä¾¡å€¤å®Ÿç¾ã®å‘ä¸Š
```
WEEDè“„ç© â†’ å¸‚å ´ä¾¡æ ¼ã§ã®å³åº§SOLå¤‰æ› â†’ Treasuryä¾¡å€¤æœ€å¤§åŒ–
ã‚¹ãƒªãƒƒãƒšãƒ¼ã‚¸ä¿è­· â†’ ä¸åˆ©ãªå¤‰æ›ãƒ¬ãƒ¼ãƒˆé˜²æ­¢ â†’ æå¤±æœ€å°åŒ–
```

### ğŸ”’ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¯¾ç­–

#### å¤šå±¤é˜²å¾¡è¨­è¨ˆ
```rust
// 1. ã‚¹ãƒªãƒƒãƒšãƒ¼ã‚¸ä¿è­·ï¼ˆæœ€å¤§5%åˆ¶é™ï¼‰
require!(slippage <= 500, MeteoraError::ExcessiveSlippage);

// 2. ç·Šæ€¥åœæ­¢æ©Ÿèƒ½
if emergency_pause { return Err(MeteoraError::SystemPaused); }

// 3. ãƒ—ãƒ¼ãƒ«æ¤œè¨¼
validate_meteora_pool_authenticity(pool_address)?;

// 4. ç®¡ç†è€…æ¨©é™åˆ¶å¾¡
require!(admin == config.admin, MeteoraError::UnauthorizedAdmin);
```

### ğŸ“Š å®Ÿè£…ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«

#### Phase 1: åŸºæœ¬çµ±åˆ (Week 1-2)
```
â–¡ FeePoolçµ±åˆå®Œäº†
â–¡ åŸºæœ¬è¨­å®šç®¡ç†å®Ÿè£…
â–¡ æ‰‹å‹•å¤‰æ›æ©Ÿèƒ½
â–¡ åŸºæœ¬ãƒ†ã‚¹ãƒˆå®Œäº†
```

#### Phase 2: é«˜åº¦æ©Ÿèƒ½ (Week 3-4)
```
â–¡ è‡ªå‹•å¤‰æ›ã‚·ã‚¹ãƒ†ãƒ 
â–¡ ã‚¹ãƒªãƒƒãƒšãƒ¼ã‚¸ä¿è­·
â–¡ ç·Šæ€¥åˆ¶å¾¡æ©Ÿèƒ½
â–¡ çµ±è¨ˆç›£è¦–ã‚·ã‚¹ãƒ†ãƒ 
```

#### Phase 3: æœ¬æ ¼é‹ç”¨ (Week 5-6)
```
â–¡ ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰çµ±åˆ
â–¡ ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–
â–¡ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ç›£æŸ»
â–¡ æœ¬ç•ªãƒ‡ãƒ—ãƒ­ã‚¤
```

### ğŸ¯ æˆåŠŸæŒ‡æ¨™

```
æŠ€è¡“æŒ‡æ¨™:
- å¤‰æ›æˆåŠŸç‡: 95%ä»¥ä¸Š
- å¹³å‡ã‚¹ãƒªãƒƒãƒšãƒ¼ã‚¸: 1%ä»¥ä¸‹  
- ã‚¬ã‚¹åŠ¹ç‡: å¾“æ¥æ¯”30%å‘ä¸Š
- ã‚·ã‚¹ãƒ†ãƒ ç¨¼åƒç‡: 99.9%ä»¥ä¸Š

çµŒæ¸ˆæŒ‡æ¨™:
- æ‰‹æ•°æ–™å¤‰æ›é¡: æœˆæ¬¡å¢—åŠ å‚¾å‘
- Treasury SOLæ®‹é«˜: å®‰å®šæˆé•·
- ãƒ¦ãƒ¼ã‚¶ãƒ¼å–å¼•æ‰‹æ•°æ–™è² æ‹…: å®Ÿè³ªçš„è»½æ¸›
- å…¨ä½“çš„ã‚²ãƒ¼ãƒ çµŒæ¸ˆæ´»æ€§åŒ–
```

ã“ã®å®Ÿè£…ã«ã‚ˆã‚Šã€**åŠ¹ç‡çš„ã§å®‰å…¨ãªWEEDâ†’SOLè‡ªå‹•å¤‰æ›ã‚·ã‚¹ãƒ†ãƒ **ãŒå®Œæˆã—ã€ã‚²ãƒ¼ãƒ çµŒæ¸ˆã®æŒç¶šå¯èƒ½æ€§ãŒå¤§å¹…ã«å‘ä¸Šã—ã¾ã™ã€‚

### ğŸ¯ ã‚³ãƒ¼ãƒ‰å“è³ªãƒ¡ãƒˆãƒªã‚¯ã‚¹

- **ğŸ›¡ï¸ ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°**: 112 ç¨®é¡ã®å…·ä½“çš„ã‚¨ãƒ©ãƒ¼ã‚¿ã‚¤ãƒ—ã¨è©³ç´°ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
- **ğŸ§ª ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸**: çµŒæ¸ˆè¨ˆç®—ã®åŒ…æ‹¬çš„å˜ä½“ãƒ†ã‚¹ãƒˆï¼ˆ26 ãƒ†ã‚¹ãƒˆï¼‰
- **ğŸ“š ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³**: æ—¥æœ¬èªãƒ»è‹±èªã«ã‚ˆã‚‹è©³ç´°ã‚³ãƒ¡ãƒ³ãƒˆ
- **ğŸ—ï¸ ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«æ€§**: 8 æ©Ÿèƒ½ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã«ã‚ˆã‚‹æ˜ç¢ºãªé–¢å¿ƒåˆ†é›¢
- **ğŸ”’ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£**: ãƒ—ãƒ­ãƒ€ã‚¯ã‚·ãƒ§ãƒ³å¯¾å¿œã®æ¤œè¨¼ã¨åˆ¶ç´„å®Ÿè£…

## ğŸ§ª å®Ÿè£…è©³ç´°

### ğŸš€ ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–

```rust
// ãƒ«ãƒƒã‚¯ã‚¢ãƒƒãƒ—ãƒ†ãƒ¼ãƒ–ãƒ« - O(1)ç¨®ç”Ÿæˆ
const SEED_THRESHOLDS: [u32; 9] = [42229, 69119, 84289, ...];

// ãƒãƒƒãƒæ“ä½œ - å˜ä¸€å‘½ä»¤ã§è¤‡æ•°çŠ¶æ…‹æ›´æ–°
pub fn claim_with_referral_distribution() -> Result<()>

// ãƒ¡ãƒ¢ãƒªåŠ¹ç‡ - ã‚³ãƒ³ãƒ‘ã‚¯ãƒˆãƒ‡ãƒ¼ã‚¿æ§‹é€ 
#[repr(u8)]
pub enum SeedType { Seed1, Seed2, ..., Seed9 }

// Gasæœ€é©åŒ– - å†—é•·æ¤œè¨¼ã®æœ€å°åŒ–
#[account(constraint = user_state.owner == user.key())]
```

### ğŸ”„ ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰äº’æ›æ€§

```rust
// å…¨ã‚¢ã‚«ã‚¦ãƒ³ãƒˆæ§‹é€ ã«å°†æ¥æ‹¡å¼µç”¨é ˜åŸŸç¢ºä¿
pub struct Config {
    // ... å®Ÿè£…ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰
    pub reserve: [u8; 64],  // å°†æ¥æ‹¡å¼µç”¨64ãƒã‚¤ãƒˆ
}

// ãƒãƒƒã‚¯ãƒ¯ãƒ¼ãƒ‰äº’æ›ãªç§»è¡Œãªã—ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰å¯¾å¿œ
```

### ğŸ“Š çµŒæ¸ˆå¥å…¨æ€§

```rust
// æ•°å­¦çš„æ¤œè¨¼æ¸ˆã¿åŠæ¸›æœŸãƒ¡ã‚«ãƒ‹ã‚ºãƒ 
// å…¬å¹³åˆ†é…ã¨ã‚¨ã‚³ãƒãƒŸãƒƒã‚¯æ”»æ’ƒé˜²æ­¢ã‚’ä¿è¨¼

// ä¾›çµ¦ä¸Šé™å¼·åˆ¶å®Ÿè£…
pub const TOTAL_WEED_SUPPLY: u64 = 120_000_000_000_000; // 120M WEED
assert!(total_minted <= TOTAL_WEED_SUPPLY);

// ã‚ªãƒ¼ãƒãƒ¼ãƒ•ãƒ­ãƒ¼å®Œå…¨é˜²æ­¢
let result = user_grow_power
    .checked_mul(base_rate)?
    .checked_mul(elapsed_time)?
    .checked_div(global_grow_power)?;
```

### ğŸ® ã‚²ãƒ¼ãƒ æˆ¦ç•¥æœ€é©åŒ–

```rust
// æ•°å­¦çš„ROIè¨ˆç®—
ROI_time = seed_cost / (grow_power * base_rate * user_share)

// è¾²å ´ãƒ¬ãƒ™ãƒ«åŠ¹ç‡åˆ†æ
Level 1: å®¹é‡4  â†’ ROIåŠ¹ç‡100%ï¼ˆåŸºæº–ï¼‰
Level 2: å®¹é‡8  â†’ ROIåŠ¹ç‡127%ï¼ˆ+27%åŠ¹ç‡ï¼‰
Level 3: å®¹é‡12 â†’ ROIåŠ¹ç‡134%ï¼ˆ+34%åŠ¹ç‡ï¼‰
Level 4: å®¹é‡16 â†’ ROIåŠ¹ç‡139%ï¼ˆ+39%åŠ¹ç‡ï¼‰
Level 5: å®¹é‡20 â†’ ROIåŠ¹ç‡142%ï¼ˆ+42%åŠ¹ç‡ï¼‰
```

---

**ğŸ• æœ€çµ‚æ›´æ–°**: 2024 å¹´ 12 æœˆ  
**ğŸ“¦ ãƒ—ãƒ­ã‚°ãƒ©ãƒ ãƒãƒ¼ã‚¸ãƒ§ãƒ³**: v1.0 Enterprise  
**âš™ï¸ Anchor Framework**: v0.31+  
**ğŸŒ Solana Version**: v1.18+  
**ğŸ¯ å®Ÿè£…å®Œäº†åº¦**: 95%ï¼ˆCore æ©Ÿèƒ½ 100%å®Œäº†ï¼‰
