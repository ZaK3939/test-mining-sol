# Solana Facility Game - プロジェクト概要

## 🎯 プロジェクト概要

Solana Facility Game は Solana ブロックチェーン上で動作する高度な農業シミュレーションゲームです。プレイヤーは農場を管理し、様々な種を育てて、WEED トークンを獲得することができます。このゲームは、持続可能な経済メカニズム、多層紹介システム、先進的なストレージ管理を特徴としています。

**プログラム ID**: `FA1xdxZNykyJaMsuSekWJrUzwY8PVh1Usn7mR8eWmw5B`

## 🌟 主要機能

- **🚀 自動アップグレード農場**: パック購入数に基づく自動農場アップグレード
- **📦 先進的ストレージ**: 合計 2,000 個の容量、種類別制限、自動廃棄機能
- **🔐 ハッシュベース招待**: プライバシー保護招待システム
- **💰 SPL Token 2022**: 2%転送手数料を含む統合システム
- **🤝 多層紹介システム**: L1(10%)、L2(5%)の紹介報酬
- **🎲 Switchboard VRF**: 検証可能なランダム種生成
- **🔬 数学的精度**: 128 ビット演算によるオーバーフロー保護

## 📊 アーキテクチャ

### 🏗️ プログラム構造

```
programs/facility-game/src/
├── lib.rs                      # メインプログラムエントリ（17の命令）
├── state.rs                    # アカウント構造とデータモデル
├── error.rs                    # カスタムエラー定義
├── constants.rs                # ゲーム定数の集中管理
├── economics.rs                # 経済計算と数式
├── utils.rs                    # ヘルパー関数とユーティリティ
├── instructions/               # 命令実装
│   ├── admin.rs                # 管理者命令
│   ├── user.rs                 # ユーザー管理命令
│   ├── farm.rs                 # 農場管理命令
│   ├── referral.rs             # 紹介報酬命令
│   ├── seeds.rs                # シード系命令
│   └── invite.rs               # ハッシュベース招待システム
└── validation/                 # ビジネスルール検証
    ├── admin_validation.rs     # 管理者権限検証
    ├── economic_validation.rs  # 経済検証
    ├── game_validation.rs      # ゲームロジック検証
    ├── time_validation.rs      # 時間関連検証
    └── user_validation.rs      # ユーザー検証
```

### 🔑 PDA シードパターン

- Config: `["config"]`
- UserState: `["user", user_pubkey]`
- FarmSpace: `["farm_space", user_pubkey]`
- SeedStorage: `["seed_storage", user_pubkey]`
- InviteCode: `["invite", inviter_pubkey, sha256(invite_code)]`
- RewardMint: `["reward_mint"]`
- MintAuthority: `["mint_authority"]`

## 🎮 ゲームメカニクス

### 🚀 自動アップグレードシステム

農場は累積パック購入数に基づいて自動的にアップグレードされます：

- **レベル 1**: 0 パック（容量: 4 種）
- **レベル 2**: 30 パック（容量: 6 種）
- **レベル 3**: 100 パック（容量: 8 種）
- **レベル 4**: 300 パック（容量: 10 種）
- **レベル 5**: 500 パック（容量: 12 種）

### 📦 先進的ストレージシステム

- **総容量**: 2,000 種
- **種類別制限**: 各種類最大 100 個
- **自動廃棄**: 制限超過時の自動処理
- **レント効率**: 種あたりのコスト比率維持

### 🌱 シードシステム

9 種類の種が存在し、それぞれ異なるレア度と成長力を持ちます：

- **Seed1**: 100GP（42.23%）
- **Seed2**: 180GP（24.44%）
- **Seed3**: 420GP（13.33%）
- **Seed4**: 720GP（8.33%）
- **Seed5**: 1000GP（5.56%）
- **Seed6**: 5000GP（3.33%）
- **Seed7**: 15000GP（1.33%）
- **Seed8**: 30000GP（0.89%）
- **Seed9**: 60000GP（0.56%）

## 💰 経済システム

### 💎 報酬配分システム

```
ユーザー報酬 = (ユーザー成長力 / 総成長力) × 基本レート × 経過時間
```

### 🤝 多層紹介システム

- **レベル 1（直接招待）**: 10%
- **レベル 2（間接招待）**: 5%
- **最大深度**: 2 レベル

### 💸 SPL Token 2022 手数料システム

- **転送手数料**: 2.00%（200 ベーシスポイント）
- **最大手数料**: 転送あたり 1,000 WEED
- **自動収集**: 国庫への自動収集

## 🔐 招待システム

### ハッシュベース設計

招待コードは SHA256 でハッシュ化され、プライバシーを保護します：

- **オペレーター招待**: 1024 回使用限度（大量マーケティング用）
- **ユーザー招待**: 5 回使用限度（友人招待用）

## 🎲 Switchboard VRF 統合

### 検証可能なランダム性

- **暗号学的証明**: サードパーティオラクル検証
- **透明な確率**: オンチェーン種レア度検証
- **操作防止**: コミット・リビールパターン
- **品質保証**: 真のランダム性 vs 疑似ランダム

## 📚 完全命令セット

### 👨‍💼 管理者命令（5 個）

1. `initialize_config` - システム設定初期化
2. `create_reward_mint` - WEED トークンミント作成
3. `initialize_global_stats` - グローバル統計初期化
4. `initialize_fee_pool` - 手数料プール初期化
5. `update_config` - システム設定更新

### 👤 ユーザー管理命令（1 個）

6. `init_user` - ユーザーアカウント初期化

### 🏭 農場管理命令（1 個）

7. `buy_farm_space` - 農場スペース購入（0.5 SOL）

### 💰 報酬システム命令（3 個）

8. `claim_reward_with_referral_rewards` - 統合報酬請求
9. `accumulate_referral_reward` - 紹介報酬蓄積
10. `view_pending_referral_rewards` - 未請求紹介報酬表示

### 🔐 招待システム命令（2 個）

11. `create_invite_code` - ハッシュベース招待コード作成
12. `use_invite_code` - ハッシュベース招待コード使用

### 🌱 シードシステム命令（7 個）

13. `initialize_seed_storage` - 先進的ストレージ初期化
14. `purchase_seed_pack` - ミステリーパック購入
15. `open_seed_pack` - パック開封
16. `plant_seed` - シード植付け
17. `remove_seed` - シード除去
18. `discard_seed` - シード廃棄
19. `batch_discard_seeds` - バッチシード廃棄

## 🔒 セキュリティと検証

### 🛡️ セキュリティ設計原則

- **PDA ベースアクセス制御**: すべてのアカウントが PDA で管理
- **署名者ベース所有権検証**: 署名による所有権確認
- **数値オーバーフロー防止**: checked_add、checked_mul の使用
- **包括的エラーハンドリング**: 100 以上の詳細エラー定義

## 🧪 実装詳細

### テストフレームワーク

- **統合テスト**: 完全なユーザージャーニーテスト
- **単体テスト**: 個別モジュール機能テスト
- **セキュリティテスト**: セキュリティ境界テスト

### 技術スタック

- **Solana**: リアルタイムゲーミング用高性能ブロックチェーン
- **Anchor フレームワーク**: 型安全な Rust 開発
- **SPL Token 2022**: 組み込み手数料を持つ先進的トークン機能
- **Switchboard VRF**: 検証可能なランダム関数
- **SHA256**: プライバシー用暗号学的ハッシュ

## 🎉 まとめ

Solana Facility Game は、**即座のアップグレード**、**先進的ストレージシステム**、**ハッシュベース招待システム**、**SPL Token 2022 統合**をコアコンポーネントとする高度な農業シミュレーションゲームです。

このゲームは、ユーザーに快適なゲーム体験を提供しながら、プロトコルの長期的な経済安定性とコミュニティ成長を確保する設計となっています。
